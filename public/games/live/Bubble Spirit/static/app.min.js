!function(t){function a(t,a,e,i,s,o){void 0===o&&(o=!0),this.oAssetData={},this.assetsLoaded=0,this.textData={},this.totalAssets=a.length,this.ctx=e,this.canvasWidth=i,this.canvasHeight=s,this.showBar=o,this.topLeftX=this.canvasWidth/2-i/4,this.topLeftY=440,this.showBar&&(ctx.strokeStyle="#ffffff",ctx.lineWidth=2,ctx.fillStyle="#1E95EF",ctx.moveTo(this.topLeftX,this.topLeftY),ctx.lineTo(this.topLeftX+i/2,this.topLeftY+0),ctx.lineTo(this.topLeftX+i/2,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+0),ctx.stroke());for(var h=0;h<a.length;h++)-1!=a[h].file.indexOf(".json")?this.loadJSON(a[h]):this.loadImage(a[h])}a.prototype.loadExtraAssets=function(t,a){this.showBar=!1,this.totalAssets=a.length,this.assetsLoaded=0,this.loadedCallback=t;for(var e=0;e<a.length;e++)-1!=a[e].file.indexOf(".json")?this.loadJSON(a[e]):this.loadImage(a[e])},a.prototype.loadJSON=function(a){var e=this,i=new XMLHttpRequest;i.open("GET",a.file,!0),i.onreadystatechange=function(){var t=new RegExp("^file:","i").test(i.responseURL);4==i.readyState&&(200==i.status||t&&0===i.status)&&(e.textData[a.id]=JSON.parse(i.responseText),++e.assetsLoaded,e.updatePreloadScreen(),e.checkLoadComplete())},i.send(null)},a.prototype.loadImage=function(a){var e=this,i=new Image;i.onload=function(){e.oAssetData[a.id]={},e.oAssetData[a.id].img=i,e.oAssetData[a.id].oData={};var t=e.getSpriteSize(a.file);0!=t[0]?(e.oAssetData[a.id].oData.spriteWidth=t[0],e.oAssetData[a.id].oData.spriteHeight=t[1]):(e.oAssetData[a.id].oData.spriteWidth=e.oAssetData[a.id].img.width,e.oAssetData[a.id].oData.spriteHeight=e.oAssetData[a.id].img.height),a.oAnims&&(e.oAssetData[a.id].oData.oAnims=a.oAnims),a.oAtlasData?e.oAssetData[a.id].oData.oAtlasData=a.oAtlasData:e.oAssetData[a.id].oData.oAtlasData={none:{x:0,y:0,width:e.oAssetData[a.id].oData.spriteWidth,height:e.oAssetData[a.id].oData.spriteHeight}},++e.assetsLoaded,e.updatePreloadScreen(),e.checkLoadComplete()},i.src=a.file},a.prototype.updatePreloadScreen=function(){ctx.fillStyle="#C094E7",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.strokeStyle="#8548B8",ctx.lineWidth=2,ctx.fillStyle="#E9DFF3",ctx.moveTo(this.topLeftX,this.topLeftY),ctx.lineTo(this.topLeftX+canvas.width/2,this.topLeftY+0),ctx.lineTo(this.topLeftX+canvas.width/2,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+0),ctx.stroke(),this.showBar&&ctx.fillRect(this.topLeftX+2,this.topLeftY+2,(this.canvasWidth/2-4)/this.totalAssets*this.assetsLoaded,16);var t=preAssetLib.getData("preloadImage");ctx.drawImage(t.img,0,0)},a.prototype.getSpriteSize=function(t){for(var a=new Array,e="",i="",s=0,o=t.lastIndexOf("."),h=!0;h;)o--,0==s&&this.isNumber(t.charAt(o))?e=t.charAt(o)+e:0==s&&0<e.length&&"x"==t.charAt(o)?(s=1,i=t.charAt(--o)+i):1==s&&this.isNumber(t.charAt(o))?i=t.charAt(o)+i:a=1==s&&0<i.length&&"_"==t.charAt(o)?(h=!1,[parseInt(i),parseInt(e)]):(h=!1,[0,0]);return a},a.prototype.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},a.prototype.checkLoadComplete=function(){this.assetsLoaded==this.totalAssets&&this.loadedCallback()},a.prototype.onReady=function(t){this.loadedCallback=t},a.prototype.getImg=function(t){return this.oAssetData[t].img},a.prototype.getData=function(t){return this.oAssetData[t]},t.AssetLoader=a}(Utils=Utils||{}),function(t){function a(t,a,e,i){this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.frameInc=0,this.animType="loop",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.oImgData=t,this.oAnims=this.oImgData.oData.oAnims,this.fps=a,this.radius=e,this.animId=i,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2)}a.prototype.updateAnimation=function(t){this.frameInc+=this.fps*t},a.prototype.changeImgData=function(t,a){this.oImgData=t,this.oAnims=this.oImgData.oData.oAnims,this.animId=a,this.centreX=Math.round(this.oImgData.oData.spriteWidth/2),this.centreY=Math.round(this.oImgData.oData.spriteHeight/2),this.resetAnim()},a.prototype.resetAnim=function(){this.frameInc=0},a.prototype.setFrame=function(t){this.fixedFrame=t},a.prototype.setAnimType=function(t,a,e){switch(void 0===e&&(e=!0),this.animId=a,this.animType=t,e&&this.resetAnim(),t){case"loop":break;case"once":this.maxIdx=this.oAnims[this.animId].length-1}},a.prototype.render=function(t){var a,e,i,s;t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.scale(this.scaleX,this.scaleY),t.globalAlpha=this.alpha,null!=this.animId?(a=this.oAnims[this.animId].length,e=Math.floor(this.frameInc),this.curFrame=this.oAnims[this.animId][e%a],i=this.curFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight,"once"==this.animType&&e>this.maxIdx&&(this.fixedFrame=this.oAnims[this.animId][a-1],(this.animId=null)!=this.animEndedFunc&&this.animEndedFunc(),i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight)):(i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight),t.drawImage(this.oImgData.img,i,s,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.centreX+this.offsetX,-this.centreY+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),t.restore()},a.prototype.renderSimple=function(t){var a,e,i,s;null!=this.animId?(a=this.oAnims[this.animId].length,e=Math.floor(this.frameInc),this.curFrame=this.oAnims[this.animId][e%a],i=this.curFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.curFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight,"once"==this.animType&&e>this.maxIdx&&(this.fixedFrame=this.oAnims[this.animId][a-1],(this.animId=null)!=this.animEndedFunc&&this.animEndedFunc(),i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight)):(i=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,s=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight),t.drawImage(this.oImgData.img,i,s,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,this.x-(this.centreX-this.offsetX)*this.scaleX,this.y-(this.centreY-this.offsetY)*this.scaleY,this.oImgData.oData.spriteWidth*this.scaleX,this.oImgData.oData.spriteHeight*this.scaleY)},t.AnimSprite=a}(Utils=Utils||{}),function(t){function a(t,a,e){void 0===e&&(e=0),this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.oImgData=t,this.radius=a,this.setFrame(e)}a.prototype.setFrame=function(t){this.frameNum=t},a.prototype.render=function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.scale(this.scaleX,this.scaleY);var a=this.frameNum*this.oImgData.oData.spriteWidth%this.oImgData.img.width,e=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;t.drawImage(this.oImgData.img,a,e,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2+this.offsetX,-this.oImgData.oData.spriteHeight/2+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight),t.restore()},t.BasicSprite=a}(Utils=Utils||{}),function(t){function a(t,a){var e=this;this.canvasX=0,this.canvasY=0,this.canvasScaleX=1,this.canvasScaleY=1,this.prevHitTime=0,this.pauseIsOn=!1,this.isDown=!1,this.isBugBrowser=a,this.keyDownEvtFunc=function(t){e.keyDown(t)},this.keyUpEvtFunc=function(t){e.keyUp(t)},t.addEventListener("touchstart",function(t){for(var a=0;a<t.changedTouches.length;a++)e.hitDown(t,t.changedTouches[a].pageX,t.changedTouches[a].pageY,t.changedTouches[a].identifier)},!1),t.addEventListener("touchend",function(t){for(var a=0;a<t.changedTouches.length;a++)e.hitUp(t,t.changedTouches[a].pageX,t.changedTouches[a].pageY,t.changedTouches[a].identifier)},!1),t.addEventListener("touchmove",function(t){for(var a=0;a<t.changedTouches.length;a++)e.move(t,t.changedTouches[a].pageX,t.changedTouches[a].pageY,t.changedTouches[a].identifier,!0)},!1),t.addEventListener("mousedown",function(t){e.isDown=!0,e.hitDown(t,t.pageX,t.pageY,1)},!1),t.addEventListener("mouseup",function(t){e.isDown=!1,e.hitUp(t,t.pageX,t.pageY,1)},!1),t.addEventListener("mousemove",function(t){e.move(t,t.pageX,t.pageY,1,e.isDown)},!1),this.aHitAreas=new Array,this.aKeys=new Array}a.prototype.setCanvas=function(t,a,e,i){this.canvasX=t,this.canvasY=a,this.canvasScaleX=e,this.canvasScaleY=i},a.prototype.hitDown=function(t,a,e,i){if(t.preventDefault(),t.stopPropagation(),!this.pauseIsOn){var s=(new Date).getTime();a=(a-this.canvasX)*this.canvasScaleX,e=(e-this.canvasY)*this.canvasScaleY;for(var o=0;o<this.aHitAreas.length;o++)if(this.aHitAreas[o].rect&&a>this.aHitAreas[o].area[0]&&e>this.aHitAreas[o].area[1]&&a<this.aHitAreas[o].area[2]&&e<this.aHitAreas[o].area[3]){if(this.aHitAreas[o].aTouchIdentifiers.push(i),this.aHitAreas[o].oData.hasLeft=!1,!this.aHitAreas[o].oData.isDown){if(this.aHitAreas[o].oData.isDown=!0,this.aHitAreas[o].oData.x=a,this.aHitAreas[o].oData.y=e,s-this.prevHitTime<500&&("game"!=gameState||"pause"==this.aHitAreas[o].id)&&isBugBrowser)return;this.aHitAreas[o].callback(this.aHitAreas[o].id,this.aHitAreas[o].oData)}break}this.prevHitTime=s}},a.prototype.hitUp=function(t,a,e,i){if(ios9FirstTouch||(playSound("silence"),ios9FirstTouch=!0),!this.pauseIsOn){t.preventDefault(),t.stopPropagation(),a=(a-this.canvasX)*this.canvasScaleX,e=(e-this.canvasY)*this.canvasScaleY;for(var s=0;s<this.aHitAreas.length;s++)if(this.aHitAreas[s].rect&&a>this.aHitAreas[s].area[0]&&e>this.aHitAreas[s].area[1]&&a<this.aHitAreas[s].area[2]&&e<this.aHitAreas[s].area[3]){for(var o=0;o<this.aHitAreas[s].aTouchIdentifiers.length;o++)this.aHitAreas[s].aTouchIdentifiers[o]==i&&(this.aHitAreas[s].aTouchIdentifiers.splice(o,1),--o);0==this.aHitAreas[s].aTouchIdentifiers.length&&(this.aHitAreas[s].oData.isDown=!1,this.aHitAreas[s].oData.multiTouch)&&(this.aHitAreas[s].oData.x=a,this.aHitAreas[s].oData.y=e,this.aHitAreas[s].callback(this.aHitAreas[s].id,this.aHitAreas[s].oData));break}}},a.prototype.move=function(t,a,e,i,s){if(!this.pauseIsOn&&s){a=(a-this.canvasX)*this.canvasScaleX,e=(e-this.canvasY)*this.canvasScaleY;for(var o=0;o<this.aHitAreas.length;o++)if(this.aHitAreas[o].rect)if(a>this.aHitAreas[o].area[0]&&e>this.aHitAreas[o].area[1]&&a<this.aHitAreas[o].area[2]&&e<this.aHitAreas[o].area[3])this.aHitAreas[o].oData.hasLeft=!1,this.aHitAreas[o].oData.isDown||(this.aHitAreas[o].oData.isDown=!0,this.aHitAreas[o].oData.x=a,this.aHitAreas[o].oData.y=e,this.aHitAreas[o].aTouchIdentifiers.push(i),this.aHitAreas[o].oData.multiTouch&&this.aHitAreas[o].callback(this.aHitAreas[o].id,this.aHitAreas[o].oData)),this.aHitAreas[o]&&this.aHitAreas[o].oData.isDraggable&&(this.aHitAreas[o].oData.isBeingDragged=!0,this.aHitAreas[o].oData.x=a,this.aHitAreas[o].oData.y=e,this.aHitAreas[o].callback(this.aHitAreas[o].id,this.aHitAreas[o].oData),this.aHitAreas[o].oData.isBeingDragged=!1);else if(this.aHitAreas[o].oData.isDown&&!this.aHitAreas[o].oData.hasLeft){for(var h=0;h<this.aHitAreas[o].aTouchIdentifiers.length;h++)this.aHitAreas[o].aTouchIdentifiers[h]==i&&(this.aHitAreas[o].aTouchIdentifiers.splice(h,1),--h);0==this.aHitAreas[o].aTouchIdentifiers.length&&(this.aHitAreas[o].oData.hasLeft=!0,this.aHitAreas[o].oData.isBeingDragged||(this.aHitAreas[o].oData.isDown=!1),this.aHitAreas[o].oData.multiTouch)&&this.aHitAreas[o].callback(this.aHitAreas[o].id,this.aHitAreas[o].oData)}}},a.prototype.keyDown=function(t){for(var a=0;a<this.aKeys.length;a++)t.keyCode==this.aKeys[a].keyCode&&(this.aKeys[a].oData.isDown=!0,this.aKeys[a].callback(this.aKeys[a].id,this.aKeys[a].oData))},a.prototype.keyUp=function(t){for(var a=0;a<this.aKeys.length;a++)t.keyCode==this.aKeys[a].keyCode&&(this.aKeys[a].oData.isDown=!1,this.aKeys[a].callback(this.aKeys[a].id,this.aKeys[a].oData))},a.prototype.checkKeyFocus=function(){window.focus(),0<this.aKeys.length&&(window.removeEventListener("keydown",this.keyDownEvtFunc,!1),window.removeEventListener("keyup",this.keyUpEvtFunc,!1),window.addEventListener("keydown",this.keyDownEvtFunc,!1),window.addEventListener("keyup",this.keyUpEvtFunc,!1))},a.prototype.addKey=function(t,a,e,i){null==e&&(e=new Object),this.aKeys.push({id:t,callback:a,oData:e,keyCode:i}),this.checkKeyFocus()},a.prototype.removeKey=function(t){for(var a=0;a<this.aKeys.length;a++)this.aKeys[a].id==t&&(this.aKeys.splice(a,1),--a)},a.prototype.addHitArea=function(t,a,e,i,s,o){void 0===o&&(o=!1),null==e&&(e=new Object),o&&this.removeHitArea(t),s.scale||(s.scale=1);var h=new Array;switch(i){case"image":var l=new Array(s.aPos[0]-s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]-s.oImgData.oData.oAtlasData[s.id].height/2*s.scale,s.aPos[0]+s.oImgData.oData.oAtlasData[s.id].width/2*s.scale,s.aPos[1]+s.oImgData.oData.oAtlasData[s.id].height/2*s.scale);this.aHitAreas.push({id:t,aTouchIdentifiers:h,callback:a,oData:e,rect:!0,area:l});break;case"rect":this.aHitAreas.push({id:t,aTouchIdentifiers:h,callback:a,oData:e,rect:!0,area:s.aRect})}},a.prototype.removeHitArea=function(t){for(var a=0;a<this.aHitAreas.length;a++)this.aHitAreas[a].id==t&&(this.aHitAreas.splice(a,1),--a)},a.prototype.resetAll=function(){for(var t=0;t<this.aHitAreas.length;t++)this.aHitAreas[t].oData.isDown=!1,this.aHitAreas[t].oData.isBeingDragged=!1,this.aHitAreas[t].aTouchIdentifiers=new Array;this.isDown=!1},t.UserInput=a}(Utils=Utils||{}),function(t){function a(t){this.updateFreq=10,this.updateInc=0,this.frameAverage=0,this.display=1,this.log="",this.render=function(t){this.frameAverage+=this.delta/this.updateFreq,++this.updateInc>=this.updateFreq&&(this.updateInc=0,this.display=this.frameAverage,this.frameAverage=0),t.textAlign="left",ctx.font="10px Helvetica",t.fillStyle="#333333",t.beginPath(),t.rect(0,this.canvasHeight-15,40,15),t.closePath(),t.fill(),t.fillStyle="#ffffff",t.fillText(Math.round(1e3/(1e3*this.display))+" fps "+this.log,5,this.canvasHeight-5)},this.canvasHeight=t}a.prototype.update=function(t){this.delta=t},t.FpsMeter=a}(Utils=Utils||{}),function(t){function a(){this.x=0,this.y=0,this.targY=0,this.incY=0,this.renderState="none",this.bgId=0,this.setBackground()}a.prototype.setBackground=function(t){-1==(t=void 0===t?-1:t)&&(t=Math.floor(5*Math.random())),this.oImgData=assetLib.getData("background"+t)},a.prototype.update=function(){switch(this.renderState){case"menuScroll":this.incY+=5*delta,this.x=this.x-50*Math.sin(this.incY/10)*delta,this.y=this.y-50*delta;break;case"ripple":this.incY+=2*delta}},a.prototype.render=function(){switch(this.renderState){case"menuScroll":this.x=this.x%canvas.width,this.y=this.y%canvas.height,this.x<0&&(this.x+=canvas.width),this.y<0&&(this.y+=canvas.height),ctx.drawImage(this.oImgData.img,this.x,this.y,canvas.width,canvas.height,0,0,canvas.width,canvas.height);break;case"ripple":ctx.drawImage(this.oImgData.img,0,0);for(var t=0;t<25;t++)ctx.drawImage(this.oImgData.img,0,t*(canvas.height/25),canvas.width,canvas.height/25,5*Math.sin(this.incY+t/2),t*(canvas.height/25),canvas.width,canvas.height/25);break;case"none":ctx.drawImage(this.oImgData.img,0,0,canvas.width,canvas.height,0,0,canvas.width,canvas.height)}},t.Background=a}(Elements=Elements||{}),function(t){function a(t,a,e){this.inc=0,this.oSplashScreenImgData=t,this.canvasWidth=a,this.canvasHeight=e,this.posY=-this.canvasHeight,TweenLite.to(this,.5,{posY:0})}a.prototype.render=function(t,a){this.inc+=5*a,t.drawImage(this.oSplashScreenImgData.img,0,0-this.posY)},t.Splash=a}(Elements=Elements||{}),function(t){function a(t,a){this.timer=.3,this.endTime=0,this.posY=0,this.numberSpace=17,this.incY=0,this.flareRot=0,this.letterSpace=24,this.numberScale=.75,this.oTitleImgData=assetLib.getData("title"),this.oSplashImgData=assetLib.getData("splash"),this.oNumbers0ImgData=assetLib.getData("numbers0"),this.oNumbers1ImgData=assetLib.getData("numbers1"),this.oTopFlareImgData=assetLib.getData("flare"),this.oGameElementsImgData=assetLib.getData("gameElements"),this.oBubblesImgData=assetLib.getData("bubbles"),this.oMapImgData=assetLib.getData("map"),this.oUiButsImgData=assetLib.getData("uiButs"),this.panelType=t,this.aButs=a}a.prototype.update=function(t){this.incY+=10*t},a.prototype.startTween1=function(){this.posY=550,TweenLite.to(this,.4,{posY:0,ease:"Back.easeOut"})},a.prototype.startMapTween=function(t){this.mapPosY=Math.max(t-100,0),this.mapTween=TweenLite.to(this,1,{mapPosY:t,ease:"Cubic.easeOut"})},a.prototype.startTween2=function(){this.posY=550,TweenLite.to(this,.5,{posY:0,ease:"Quad.easeOut"})},a.prototype.tweenOffScreen=function(t){void 0===t&&(t=null),TweenLite.to(this,.5,{posY:550,ease:"Quad.easeIn",onComplete:t})},a.prototype.render=function(t,a){switch((a=void 0===a?!0:a)||this.addButs(t),this.panelType){case"start":this.flareRot+=delta/3,t.save(),t.translate(canvas.width/2,292+this.posY),t.rotate(this.flareRot),t.scale(1.3,1.3),t.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),t.restore(),t.save(),t.translate(canvas.width/2,292+this.posY),t.rotate(-this.flareRot),t.scale(1.3,1.3),t.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),t.restore(),t.drawImage(this.oTitleImgData.img,0,0,canvas.width,canvas.height,0,0+this.posY,canvas.width,canvas.height);for(var e=0;e<totalScore.toString().length;e++){var i=(d=parseFloat(totalScore.toString().charAt(e)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,s=Math.floor(d/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,i,s,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,10+e*(this.letterSpace*this.numberScale),4,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}break;case"map":this.mapPosRealY-=8*(this.mapPosRealY-this.mapPosY)*delta,ctx.drawImage(this.oMapImgData.img,0,this.mapPosRealY,canvas.width,canvas.height,0,0,canvas.width,canvas.height),-1!=this.mapButIdToHighlight&&(this.flareRot+=delta/3,ctx.save(),ctx.translate(aMapButs[this.mapButIdToHighlight][0],aMapButs[this.mapButIdToHighlight][1]-this.mapPosRealY),ctx.rotate(this.flareRot),ctx.scale(.5,.5),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore(),ctx.save(),ctx.translate(aMapButs[this.mapButIdToHighlight][0],aMapButs[this.mapButIdToHighlight][1]-this.mapPosRealY),ctx.rotate(-this.flareRot),ctx.scale(.5,.5),ctx.drawImage(this.oTopFlareImgData.img,-this.oTopFlareImgData.img.width/2,-this.oTopFlareImgData.img.height/2),ctx.restore());for(e=0;e<aMapButs.length;e++){var o=0==saveDataHandler.getStars(e)?0:1,h=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapBut"+o]].x,l=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapBut"+o]].y,r=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapBut"+o]].width,n=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapBut"+o]].height;t.drawImage(this.oUiButsImgData.img,h,l,r,n,aMapButs[e][0]-r/2,aMapButs[e][1]-n/2-this.mapPosRealY,r,n),1==o&&aLevelData.length>e&&1<(o=saveDataHandler.getStars(e))&&(h=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapStars"+(o-2)]].x,l=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapStars"+(o-2)]].y,r=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapStars"+(o-2)]].width,n=this.oUiButsImgData.oData.oAtlasData[oImageIds["mapStars"+(o-2)]].height,t.drawImage(this.oUiButsImgData.img,h,l,r,n,aMapButs[e][0]-r/2,aMapButs[e][1]-n/2-this.mapPosRealY-20,r,n))}-1!=this.mapButIdToHighlight&&(h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.hintFinger].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.hintFinger].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.hintFinger].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.hintFinger].height,t.drawImage(this.oGameElementsImgData.img,h,l,r,n,aMapButs[this.mapButIdToHighlight][0]-r/2,aMapButs[this.mapButIdToHighlight][1]-n-this.mapPosRealY+5*Math.sin(this.incY+45*this.mapButIdToHighlight)-20,r,n));for(e=0;e<totalScore.toString().length;e++){i=(d=parseFloat(totalScore.toString().charAt(e)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,s=Math.floor(d/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,i,s,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,10+e*(this.letterSpace*this.numberScale),4,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}break;case"credits":t.drawImage(this.oSplashImgData.img,0,0,canvas.width,canvas.height,0,0+this.posY,canvas.width,canvas.height);break;case"startPanel":h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].height;if(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2,300-n/2+this.posY,r,n),0==aLevelData[levelNum]["@levelType"]){0==bubbleTargId?(h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].height,ctx.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2+10-r/2,317-n/2+this.posY,r,n)):(i=(bubbleTargId-1)*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,s=Math.floor((bubbleTargId-1)/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight,ctx.drawImage(this.oBubblesImgData.img,i,s,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,canvas.width/2+10-this.oBubblesImgData.oData.spriteWidth/2,317-this.oBubblesImgData.oData.spriteHeight/2+this.posY,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight));for(e=0;e<bubbleTargNum.toString().length;e++){i=(d=parseFloat(bubbleTargNum.toString().charAt(e)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,s=Math.floor(d/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,i,s,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,canvas.width/2-16+e*(this.letterSpace*this.numberScale)-this.letterSpace*bubbleTargNum.toString().length*this.numberScale,300+this.posY,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}}else if(1==aLevelData[levelNum]["@levelType"]){h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.ceiling].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.ceiling].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.ceiling].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.ceiling].height;t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2*.55,290+this.posY,.55*r,.55*n);for(e=0;e<6;e++){i=16*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,s=Math.floor(16/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,i,s,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,canvas.width/2-110+36*e,320+this.posY,.9*this.oBubblesImgData.oData.spriteWidth,.9*this.oBubblesImgData.oData.spriteHeight)}}else for(e=0;e<5;e++){i=(e+10)*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,s=Math.floor((e+10)/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,i,s,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,canvas.width/2-93-this.oBubblesImgData.oData.spriteWidth/2+45*e,335-this.oBubblesImgData.oData.spriteHeight/2+this.posY,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight)}var u={text:"startLevel"+aLevelData[levelNum]["@levelType"],x:canvas.width/2,y:260+this.posY,alignX:"centre",alignY:"centre",lineOffsetY:-6,maxWidth:270};textDisplay.renderText(u);break;case"endPanel":t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,canvas.width,canvas.height);for(var m,h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].height,h=(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2,310-n/2+this.posY,r,n),m=starBarLength>=aStarMarkers[0]/aStarMarkers[2]?"star":"starFade",this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].x),l=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].height,h=(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-95-r/2,190-n/2+this.posY,r,n),m=starBarLength>=aStarMarkers[1]/aStarMarkers[2]?"star":"starFade",this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].x),l=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].height,h=(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2,175-n/2+this.posY,r,n),m=starBarLength>=aStarMarkers[2]/aStarMarkers[2]?"star":"starFade",this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].x),l=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds[m]].height,u=(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2+95-r/2,190-n/2+this.posY,r,n),{text:"endLevel"+aLevelData[levelNum]["@levelType"],x:canvas.width/2,y:260+this.posY,alignX:"centre",alignY:"top",lineOffsetY:-6,scale:.9,maxWidth:270}),u=(textDisplay.renderText(u),{text:"levelScore",x:canvas.width/2,y:305+this.posY,alignX:"centre",alignY:"top",lineOffsetY:-6,scale:.9,maxWidth:270}),g=(textDisplay.renderText(u),1),e=0;e<levelScore.toString().length;e++){i=(d=parseFloat(levelScore.toString().charAt(e)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,s=Math.floor(d/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,i,s,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,canvas.width/2+e*(this.letterSpace*g)-this.letterSpace*levelScore.toString().length/2*g,345+this.posY,this.oNumbers0ImgData.oData.spriteWidth*g,this.oNumbers0ImgData.oData.spriteHeight*g)}break;case"endFailPanel":t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,canvas.width,canvas.height);for(h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.infoPanel].height,u=(t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2,310-n/2+this.posY,r,n),{text:"gameOver",x:canvas.width/2,y:158+this.posY,alignX:"centre",alignY:"top",lineOffsetY:-6,scale:.9,maxWidth:270}),u=(textDisplay.renderText(u),{text:"tryAgain",x:canvas.width/2,y:350+this.posY,alignX:"centre",alignY:"top",lineOffsetY:-6,scale:.9,maxWidth:270}),u=(textDisplay.renderText(u),{text:"totalScore",x:canvas.width/2,y:260+this.posY,alignX:"centre",alignY:"top",lineOffsetY:-6,scale:.9,maxWidth:270}),g=(textDisplay.renderText(u),1),e=0;e<totalScore.toString().length;e++){var d,i=(d=parseFloat(totalScore.toString().charAt(e)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,s=Math.floor(d/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,i,s,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,canvas.width/2+e*(this.letterSpace*g)-this.letterSpace*totalScore.toString().length/2*g,300+this.posY,this.oNumbers0ImgData.oData.spriteWidth*g,this.oNumbers0ImgData.oData.spriteHeight*g)}break;case"pause":t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,canvas.width,canvas.height);h=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].x,l=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].y,r=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].width,n=this.oGameElementsImgData.oData.oAtlasData[oImageIds.introPanel].height;t.drawImage(this.oGameElementsImgData.img,h,l,r,n,canvas.width/2-r/2,310-n/2+this.posY,r,n)}a&&this.addButs(t)},a.prototype.addButs=function(t){for(var a=0;a<this.aButs.length;a++){var e=this.posY,i=0,s=(0==this.incY||this.aButs[a].noMove||(i=3*Math.sin(this.incY+45*a)),this.aButs[a].scale||(this.aButs[a].scale=1),this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].x),o=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].y,h=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].width,l=this.aButs[a].oImgData.oData.oAtlasData[this.aButs[a].id].height;t.drawImage(this.aButs[a].oImgData.img,s,o,h,l,this.aButs[a].aPos[0]-h/2*this.aButs[a].scale-i/2,this.aButs[a].aPos[1]-l/2*this.aButs[a].scale+i/2+this.posY,h*this.aButs[a].scale+i,l*this.aButs[a].scale-i),this.aButs[a].text&&(s={text:this.aButs[a].text,x:this.aButs[a].aPos[0]+e,y:this.aButs[a].aPos[1],alignX:"centre",alignY:"centre",maxWidth:h-8},textDisplay.renderText(s))}},t.Panel=a}(Elements=Elements||{}),function(t){function a(){this.bonusScore=0,this.letterSpace=24,this.aSpecialBubbleIds=new Array,this.numberScale=.75,this.starBarLength=179,this.oHudImgData=assetLib.getData("hud"),this.oNumbers0ImgData=assetLib.getData("numbers0"),this.oGameElementsImgData=assetLib.getData("gameElements"),this.oUiButsImgData=assetLib.getData("uiButs"),this.oBubblesImgData=assetLib.getData("bubbles"),1==aLevelData[levelNum]["@vBombs"]&&this.aSpecialBubbleIds.push(5),1==aLevelData[levelNum]["@hBombs"]&&this.aSpecialBubbleIds.push(6),1==aLevelData[levelNum]["@lBombs"]&&this.aSpecialBubbleIds.push(7),1==aLevelData[levelNum]["@rBubbles"]&&this.aSpecialBubbleIds.push(15),this.addNextBubble()}a.prototype.setLevelSpecificTargets=function(t,a){1==aLevelData[levelNum]["@levelType"]?aLevelSpecificTarget=new Array(t,6):2==aLevelData[levelNum]["@levelType"]&&(aLevelSpecificTarget=new Array(0,a))},a.prototype.getRandomBubble=function(){for(var t=new Array,a=0;a<aAllowedBubbleStates.length;a++)aAllowedBubbleStates[a]&&t.push(a);return 0<this.aSpecialBubbleIds.length&&+Math.random()<aLevelData[levelNum]["@specialChance"]/100?this.aSpecialBubbleIds[Math.floor(Math.random()*this.aSpecialBubbleIds.length)]:t[Math.floor(Math.random()*t.length)]},a.prototype.addNextBubble=function(){this.nextBubbleId=this.getRandomBubble()},a.prototype.renderOver=function(){var t=(r=1)*this.oHudImgData.oData.spriteWidth%this.oHudImgData.img.width,a=Math.floor(r/(this.oHudImgData.img.width/this.oHudImgData.oData.spriteWidth))*this.oHudImgData.oData.spriteHeight,e=(ctx.drawImage(this.oHudImgData.img,t,a,this.oHudImgData.oData.spriteWidth,this.oHudImgData.oData.spriteHeight,0,0,this.oHudImgData.oData.spriteWidth,this.oHudImgData.oData.spriteHeight),this.oUiButsImgData.oData.oAtlasData[oImageIds.pauseBut].x),i=this.oUiButsImgData.oData.oAtlasData[oImageIds.pauseBut].y,s=this.oUiButsImgData.oData.oAtlasData[oImageIds.pauseBut].width,o=this.oUiButsImgData.oData.oAtlasData[oImageIds.pauseBut].height;ctx.drawImage(this.oUiButsImgData.img,e,i,s,o,385,0,s,o),0<starBarLength&&(e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.starBar].x,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.starBar].y,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.starBar].width,o=this.oGameElementsImgData.oData.oAtlasData[oImageIds.starBar].height,ctx.drawImage(this.oGameElementsImgData.img,e,i,s*starBarLength,o,185,20-o/2,s*starBarLength,o));for(var h=0;h<aStarMarkers.length;h++){var l=.3,e=(starBarLength>=aStarMarkers[h]/aStarMarkers[2]&&(l=.45),this.oGameElementsImgData.oData.oAtlasData[oImageIds.star].x),i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.star].y,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.star].width,o=this.oGameElementsImgData.oData.oAtlasData[oImageIds.star].height;ctx.drawImage(this.oGameElementsImgData.img,e,i,s,o,185+aStarMarkers[h]/aStarMarkers[2]*this.starBarLength-s/2*l,20-o/2*l,s*l,o*l)}(0==aLevelData[levelNum]["@bLimit"]||0!=aLevelData[levelNum]["@bLimit"]&&0<bubblesToFire)&&(t=this.nextBubbleId*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(this.nextBubbleId/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight,ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,88-this.oBubblesImgData.oData.spriteWidth/2,572-this.oBubblesImgData.oData.spriteHeight/2,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight));for(h=0;h<totalScore.toString().length;h++){var t=(r=parseFloat(totalScore.toString().charAt(h)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,165+h*(this.letterSpace*this.numberScale)-this.letterSpace*totalScore.toString().length*this.numberScale,4,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}if(0!=aLevelData[levelNum]["@bLimit"])for(l=.5,h=0;h<bubblesToFire.toString().length;h++){var t=(r=parseFloat(bubblesToFire.toString().charAt(h)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,86+h*(this.letterSpace*l)-this.letterSpace*bubblesToFire.toString().length/2*l,530,this.oNumbers0ImgData.oData.spriteWidth*l,this.oNumbers0ImgData.oData.spriteHeight*l)}if(0==aLevelData[levelNum]["@levelType"]){0<bubbleTargId?(t=(r=bubbleTargId-1)*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(r/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight,ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,425-this.oBubblesImgData.oData.spriteWidth/2,675-this.oBubblesImgData.oData.spriteHeight/2,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight)):(e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].x,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].y,s=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].width,o=this.oGameElementsImgData.oData.oAtlasData[oImageIds.allColourBubble].height,ctx.drawImage(this.oGameElementsImgData.img,e,i,s,o,425-s/2,675-o/2,s,o));for(h=0;h<bubbleTargNum.toString().length;h++){t=(r=parseFloat(bubbleTargNum.toString().charAt(h)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,400+h*(this.letterSpace*this.numberScale)-this.letterSpace*bubbleTargNum.toString().length*this.numberScale,662,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}}else{a=1==aLevelData[levelNum]["@levelType"]?(t=16*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,Math.floor(16/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight):(t=10*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,Math.floor(10/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight),ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,425-this.oBubblesImgData.oData.spriteWidth/2,675-this.oBubblesImgData.oData.spriteHeight/2,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight);for(h=0;h<aLevelSpecificTarget[0].toString().length;h++){t=(r=parseFloat(aLevelSpecificTarget[0].toString().charAt(h)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,400+h*(this.letterSpace*this.numberScale)-this.letterSpace*(1+aLevelSpecificTarget[0].toString().length+aLevelSpecificTarget[1].toString().length)*this.numberScale,662,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}t=(r=10)*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,400-this.letterSpace*(1+aLevelSpecificTarget[1].toString().length)*this.numberScale,662,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale);for(h=0;h<aLevelSpecificTarget[1].toString().length;h++){var r,t=(r=parseFloat(aLevelSpecificTarget[1].toString().charAt(h)))*this.oNumbers0ImgData.oData.spriteWidth%this.oNumbers0ImgData.img.width,a=Math.floor(r/(this.oNumbers0ImgData.img.width/this.oNumbers0ImgData.oData.spriteWidth))*this.oNumbers0ImgData.oData.spriteHeight;ctx.drawImage(this.oNumbers0ImgData.img,t,a,this.oNumbers0ImgData.oData.spriteWidth,this.oNumbers0ImgData.oData.spriteHeight,400+h*(this.letterSpace*this.numberScale)-this.letterSpace*aLevelSpecificTarget[1].toString().length*this.numberScale,662,this.oNumbers0ImgData.oData.spriteWidth*this.numberScale,this.oNumbers0ImgData.oData.spriteHeight*this.numberScale)}}},a.prototype.renderUnder=function(){var t=0*this.oHudImgData.oData.spriteWidth%this.oHudImgData.img.width,a=Math.floor(0/(this.oHudImgData.img.width/this.oHudImgData.oData.spriteWidth))*this.oHudImgData.oData.spriteHeight;ctx.drawImage(this.oHudImgData.img,t,a,this.oHudImgData.oData.spriteWidth,this.oHudImgData.oData.spriteHeight,0,0,this.oHudImgData.oData.spriteWidth,this.oHudImgData.oData.spriteHeight)},t.Hud=a}(Elements=Elements||{}),function(t){function a(){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.vx=0,this.vy=0,this.isFlying=!1,this.oBubblesImgData=assetLib.getData("bubbles"),this.reset(!0)}a.prototype.reset=function(t){if(void 0===t&&(t=!1),this.wasClose=!1,t)this.id=hud.getRandomBubble();else{if(!(0==aLevelData[levelNum]["@bLimit"]||0!=aLevelData[levelNum]["@bLimit"]&&0<=--bubblesToFire))return void(bubblesToFire=0);this.id=hud.nextBubbleId,hud.addNextBubble()}this.x=bubbleStartX,this.y=bubbleStartY},a.prototype.shoot=function(){this.isFlying=!0,this.vx=900*Math.cos(aimRot),this.vy=900*Math.sin(aimRot)},a.prototype.tweenBubbleToPark=function(){this.isFlying=!1,this.hitAngle=Math.atan2(this.vy,this.vx),this.vx=0,this.vy=0,gameTouchState=3,bubbleStack.addBubble(this.id,bubbleTarget.x,bubbleTarget.y)},a.prototype.update=function(){2==gameTouchState&&this.isFlying&&(this.x-=this.vx*delta,this.y-=this.vy*delta,this.x<wallDepth+ballRadius?(this.x=wallDepth+ballRadius,this.vx*=-1,playSound("bounce")):this.x>canvas.width-(wallDepth+ballRadius)&&(this.x=canvas.width-(wallDepth+ballRadius),this.vx*=-1,playSound("bounce")),this.x,bubbleTarget.x,this.x,bubbleTarget.x,this.y,bubbleTarget.y,this.y,bubbleTarget.y,this.y<bubbleTarget.y)&&this.tweenBubbleToPark()},a.prototype.render=function(){var t,a;gameControlState&&gameTouchState<=2&&(t=this.id*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(this.id/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight,ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,this.x-this.oBubblesImgData.oData.spriteWidth/2,this.y-this.oBubblesImgData.oData.spriteHeight/2,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight))},t.UserBubble=a}(Elements=Elements||{}),function(t){function a(){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.colourId=0,this.aimLineAlpha=0,this.aimLineLength=0,this.hitSomething=!1,this.lineScroll=0,this.oGameElementsImgData=assetLib.getData("gameElements")}a.prototype.findNearestFreePos=function(t,a,e){var i=0;for(this.hitSomething=!1;i<this.aimLineLength;){for(var s=t-i*Math.cos(e),o=a-i*Math.sin(e)-bubbleStack.ceiling,h=0;h<bubbleStack.aFreePos.length;h++)if((s-bubbleStack.aFreePos[h].targX)*(s-bubbleStack.aFreePos[h].targX)+(o-bubbleStack.aFreePos[h].targY)*(o-bubbleStack.aFreePos[h].targY)<ballRadius*ballRadius){bubbleTarget={x:bubbleStack.aFreePos[h].posX,y:bubbleStack.ceiling+bubbleStack.aFreePos[h].posY},this.aimLineLength=i,this.hitSomething=!0;break}i++}},a.prototype.update=function(){this.lineScroll+=50*delta,500<this.lineScroll&&(this.lineScroll=0)},a.prototype.render=function(){ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(aimRot);var t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["launcher"+userBubble.id]].x,a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["launcher"+userBubble.id]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["launcher"+userBubble.id]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["launcher"+userBubble.id]].height;if(ctx.drawImage(this.oGameElementsImgData.img,t,a,e,i,-20,-i/2,e,i),ctx.restore(),0==gameTouchState)for(var s,o,h,l,r=oImageIds["aimLine"+Math.min(userBubble.id,5)],t=this.oGameElementsImgData.oData.oAtlasData[r].x,a=this.oGameElementsImgData.oData.oAtlasData[r].y,e=this.oGameElementsImgData.oData.oAtlasData[r].width,i=this.oGameElementsImgData.oData.oAtlasData[r].height,n=Math.abs(Math.tan(aimRot)*(canvas.width/2-(wallDepth+ballRadius))),u=(this.aimLineLength=Math.min(Math.sqrt(n*n+(canvas.width/2-(wallDepth+ballRadius))*(canvas.width/2-(wallDepth+ballRadius))),bubbleStartY-bubbleStack.ceiling+100),this.findNearestFreePos(bubbleStartX,bubbleStartY,aimRot),this.aimLineLength=Math.min(this.aimLineLength,e),ctx.save(),ctx.globalAlpha=this.aimLineAlpha,ctx.translate(this.x,this.y),ctx.rotate(aimRot),ctx.drawImage(this.oGameElementsImgData.img,t+(e/2-this.aimLineLength)+this.lineScroll,a,e/2-(e/2-this.aimLineLength),i,-this.aimLineLength,-i/2,e/2-(e/2-this.aimLineLength),i),ctx.restore(),s=aimingFlipped?aimX<canvas.width/2?"right":"left":aimX<canvas.width/2?"left":"right",bubbleStartY),m=0;!this.hitSomething&&n<u-bubbleStack.ceiling;)if("left"==s?(t=this.oGameElementsImgData.oData.oAtlasData[r].x,a=this.oGameElementsImgData.oData.oAtlasData[r].y,e=this.oGameElementsImgData.oData.oAtlasData[r].width,i=this.oGameElementsImgData.oData.oAtlasData[r].height,o=m%2==0?180*radian-aimRot:aimRot,h=Math.abs(Math.tan(o)*(canvas.width-2*(wallDepth+ballRadius))),this.aimLineLength=Math.min(Math.sqrt(h*h+(canvas.width-2*(wallDepth+ballRadius))*(canvas.width-2*(wallDepth+ballRadius))),bubbleStartY-bubbleStack.ceiling+100),this.findNearestFreePos(wallDepth+ballRadius,u-n,o),this.aimLineLength=Math.min(this.aimLineLength,e),0==m&&(ctx.save(),ctx.globalAlpha=this.aimLineAlpha,ctx.translate(wallDepth+ballRadius,u-n),ctx.rotate(o),l=Math.max(Math.min(this.aimLineLength,70),1),ctx.drawImage(this.oGameElementsImgData.img,t+this.lineScroll,a,l,i,-l,-i/2,l,i),ctx.restore()),u-=n,n=h,s="right"):"right"==s&&(t=this.oGameElementsImgData.oData.oAtlasData[r].x,a=this.oGameElementsImgData.oData.oAtlasData[r].y,e=this.oGameElementsImgData.oData.oAtlasData[r].width,i=this.oGameElementsImgData.oData.oAtlasData[r].height,o=m%2==0?180*radian-aimRot:aimRot,h=Math.abs(Math.tan(o)*(canvas.width-2*(wallDepth+ballRadius))),this.aimLineLength=Math.min(Math.sqrt(h*h+(canvas.width-2*(wallDepth+ballRadius))*(canvas.width-2*(wallDepth+ballRadius))),bubbleStartY-bubbleStack.ceiling+100),this.findNearestFreePos(canvas.width-(wallDepth+ballRadius),u-n,o),this.aimLineLength=Math.min(this.aimLineLength,e),0==m&&(ctx.save(),ctx.globalAlpha=this.aimLineAlpha,ctx.translate(canvas.width-(wallDepth+ballRadius),u-n),ctx.rotate(o),l=Math.max(Math.min(this.aimLineLength,70),1),ctx.drawImage(this.oGameElementsImgData.img,t+this.lineScroll,a,l,i,-l,-i/2,l,i),ctx.restore()),u-=n,n=h,s="left"),50<++m)break},t.Launcher=a}(Elements=Elements||{}),function(t){function a(t){this.ceilingLimit=55,this.moveCeilingUpAt=385,this.moveCeilingDownAt=360,this.freePosAdjust=.8,this.hasRemoved=!1,this.praiseTarg=10,this.oBubblesImgData=assetLib.getData("bubbles"),this.ceiling=this.ceilingLimit,this.aBubblePos=new Array;for(var a,e=wallDepth+ballRadius,i=ballRadius,s=0,o=0,h=10,l=0,r=0;r<t.length;r++)-1!=t[r]&&(10==(a=t[r])&&(a+=Math.floor(5*Math.random())),0==s&&h--,10==t[r]&&l++,this.aBubblePos.push({id:a,x:e,y:i,state:0,float:0,vx:0,vy:0,inc:0,dist:0})),e+=2*ballRadius,o++,s%2==0?10==o&&(o=0,e=wallDepth+ballRadius+ballRadius,i+=1.75*ballRadius,s++):9==o&&(o=0,e=wallDepth+ballRadius,i+=1.75*ballRadius,s++);this.animateInitialCeiling(),hud.setLevelSpecificTargets(h,l),this.getAllFreePos()}a.prototype.animateInitialCeiling=function(){var t=this,a=this.getLowestBubbleY()+this.ceiling,e=this.ceiling;a>this.moveCeilingUpAt&&(e=this.ceiling-(a-this.moveCeilingUpAt)),TweenLite.to(this,1,{ceiling:e,ease:"Quad.easeInOut",onComplete:function(){t.animateInitialComplete()}})},a.prototype.animateInitialComplete=function(){gameTouchState=0},a.prototype.setCeiling=function(){var t=this.getLowestBubbleY()+this.ceiling;t>this.moveCeilingUpAt&&(this.ceiling=this.ceiling-(t-this.moveCeilingUpAt))},a.prototype.addBubble=function(t,a,e){var i=this,s=(this.aBubblePos.push({id:t,x:a,y:e-this.ceiling,state:1,float:0,vx:0,vy:0,inc:0,dist:0}),this.aToRemove=new Array,this.aSpecials=new Array,!0),o=!1;switch(t){case 0:case 1:case 2:case 3:case 4:this.findMatchingConnectingBubbles(t,a,e-this.ceiling),s=!1;break;case 15:this.findRainbowConnectingBubbles(t,a,e-this.ceiling,!0);break;case 5:this.findVerticleBubbles(t,a,e-this.ceiling,!0),o=!0;break;case 6:this.findHorizontalBubbles(t,a,e-this.ceiling,!0),o=!0;break;case 7:this.findNuclearBubbles(t,a,e-this.ceiling,!0),o=!0}for(var h=0;h<this.aSpecials.length;h++)switch(this.aSpecials[h].id){case 5:this.findVerticleBubbles(this.aSpecials[h].id,this.aSpecials[h].x,this.aSpecials[h].y),o=!0;break;case 6:this.findHorizontalBubbles(this.aSpecials[h].id,this.aSpecials[h].x,this.aSpecials[h].y),o=!0;break;case 7:this.findNuclearBubbles(this.aSpecials[h].id,this.aSpecials[h].x,this.aSpecials[h].y),o=!0;break;case 9:playSound("bonusBubble")}if(o&&playSound("explode"+Math.floor(4*Math.random())),3<=this.aToRemove.length||4<t||0<this.aSpecials.length)curPopChain++,this.hasRemoved=!0,0<this.aSpecials.length||s?addFirework(1,a,e):addFirework(0,a,e),this.findFloatingBubbles(),this.removeBubbles(a,e-this.ceiling);else{curPopChain=-1,this.hasRemoved=!1,playSound("bounce");for(h=0;h<this.aBubblePos.length;h++)this.aBubblePos[h].state=0}this.getAllFreePos();var l=this.getLowestBubbleY()+this.ceiling;l>this.moveCeilingUpAt?TweenLite.to(this,.75,{ceiling:this.ceiling-(l-this.moveCeilingUpAt),ease:"Quad.easeInOut",onComplete:function(){i.ceilingMoved()}}):l<this.moveCeilingDownAt&&this.ceiling<this.ceilingLimit?TweenLite.to(this,.75,{ceiling:Math.min(this.ceiling+(this.moveCeilingDownAt-l),this.ceilingLimit),ease:"Quad.easeInOut",onComplete:function(){i.ceilingMoved()}}):this.ceilingMoved()},a.prototype.findNuclearBubbles=function(t,a,e,i){void 0===i&&(i=!1);for(var s=4*ballRadius*(4*ballRadius)+50,o=0;o<this.aBubblePos.length;o++){this.aBubblePos[o].float=1;var h=(a-this.aBubblePos[o].x)*(a-this.aBubblePos[o].x)+(e-this.aBubblePos[o].y)*(e-this.aBubblePos[o].y),l=Math.atan2(e-this.aBubblePos[o].y,a-this.aBubblePos[o].x),r=Math.max(2e4-h,0)/500;this.aBubblePos[o].vx=r*Math.cos(l),this.aBubblePos[o].vy=r*Math.sin(l),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5,this.aBubblePos[o].range=Math.sqrt(h)/25,a!=this.aBubblePos[o].x||e!=this.aBubblePos[o].y?h<s&&(this.aToRemove.push(this.aBubblePos[o]),this.aBubblePos[o].state=1,i)&&4<this.aBubblePos[o].id&&8!=this.aBubblePos[o].id&&!(9<this.aBubblePos[o].id&&this.aBubblePos[o].id<15)&&(this.aSpecials.push(this.aBubblePos[o]),this.aBubblePos[o].state=1):(this.aBubblePos[o].vx=r*Math.cos(userBubble.hitAngle),this.aBubblePos[o].vy=r*Math.sin(userBubble.hitAngle),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5)}this.aToRemove.push({id:t,x:a,y:e})},a.prototype.findHorizontalBubbles=function(t,a,e,i){void 0===i&&(i=!1);for(var s=2*ballRadius*(2*ballRadius)+50,o=0;o<this.aBubblePos.length;o++){this.aBubblePos[o].float=1;var h=(a-this.aBubblePos[o].x)*(a-this.aBubblePos[o].x)+(e-this.aBubblePos[o].y)*(e-this.aBubblePos[o].y),l=Math.atan2(e-this.aBubblePos[o].y,a-this.aBubblePos[o].x),r=Math.max(2e4-h,0)/500;this.aBubblePos[o].vx=r*Math.cos(l),this.aBubblePos[o].vy=r*Math.sin(l),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5,a!=this.aBubblePos[o].x||e!=this.aBubblePos[o].y?(e==this.aBubblePos[o].y&&(this.aToRemove.push(this.aBubblePos[o]),this.aBubblePos[o].range=Math.abs(Math.round((this.aBubblePos[o].x-a)/(2*ballRadius))),this.aBubblePos[o].state=1),i&&h<s&&4<this.aBubblePos[o].id&&8!=this.aBubblePos[o].id&&!(9<this.aBubblePos[o].id&&this.aBubblePos[o].id<15)&&(this.aSpecials.push(this.aBubblePos[o]),this.aBubblePos[o].state=1)):(this.aBubblePos[o].vx=r*Math.cos(userBubble.hitAngle),this.aBubblePos[o].vy=r*Math.sin(userBubble.hitAngle),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5)}this.aToRemove.push({id:t,x:a,y:e})},a.prototype.findVerticleBubbles=function(t,a,e,i){void 0===i&&(i=!1);for(var s=2*ballRadius*(2*ballRadius)+50,o=0;o<this.aBubblePos.length;o++){this.aBubblePos[o].float=1;var h=(a-this.aBubblePos[o].x)*(a-this.aBubblePos[o].x)+(e-this.aBubblePos[o].y)*(e-this.aBubblePos[o].y),l=Math.atan2(e-this.aBubblePos[o].y,a-this.aBubblePos[o].x),r=Math.max(2e4-h,0)/500;this.aBubblePos[o].vx=r*Math.cos(l),this.aBubblePos[o].vy=r*Math.sin(l),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5,a!=this.aBubblePos[o].x||e!=this.aBubblePos[o].y?(a>this.aBubblePos[o].x-ballRadius-5&&a<this.aBubblePos[o].x+ballRadius+5&&e>this.aBubblePos[o].y-300&&e<this.aBubblePos[o].y+300&&(this.aToRemove.push(this.aBubblePos[o]),this.aBubblePos[o].range=Math.abs(Math.round((this.aBubblePos[o].y-e)/(2*ballRadius))),this.aBubblePos[o].state=1),i&&h<s&&4<this.aBubblePos[o].id&&8!=this.aBubblePos[o].id&&!(9<this.aBubblePos[o].id&&this.aBubblePos[o].id<15)&&(this.aSpecials.push(this.aBubblePos[o]),this.aBubblePos[o].state=1)):(this.aBubblePos[o].vx=r*Math.cos(userBubble.hitAngle),this.aBubblePos[o].vy=r*Math.sin(userBubble.hitAngle),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5)}this.aToRemove.push({id:t,x:a,y:e})},a.prototype.findRainbowConnectingBubbles=function(t,a,e,i){void 0===i&&(i=!1);for(var s=2*ballRadius*(2*ballRadius)+50,o=0;o<this.aBubblePos.length;o++){this.aBubblePos[o].float=1;var h=(a-this.aBubblePos[o].x)*(a-this.aBubblePos[o].x)+(e-this.aBubblePos[o].y)*(e-this.aBubblePos[o].y),l=Math.atan2(e-this.aBubblePos[o].y,a-this.aBubblePos[o].x),r=Math.max(2e4-h,0)/500;this.aBubblePos[o].vx=r*Math.cos(l),this.aBubblePos[o].vy=r*Math.sin(l),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5,this.aBubblePos[o].range=Math.sqrt(h)/25,a!=this.aBubblePos[o].x||e!=this.aBubblePos[o].y?h<s&&(4<this.aBubblePos[o].id&&8!=this.aBubblePos[o].id&&!(9<this.aBubblePos[o].id&&this.aBubblePos[o].id<15)?(this.aSpecials.push(this.aBubblePos[o]),this.aBubblePos[o].state=1):this.aBubblePos[o].id<5?(this.aBubblePos[o].state=1,this.aToRemove.push(this.aBubblePos[o])):i&&4<this.aBubblePos[o].id&&8!=this.aBubblePos[o].id&&!(9<this.aBubblePos[o].id&&this.aBubblePos[o].id<15)&&(this.aSpecials.push(this.aBubblePos[o]),this.aBubblePos[o].state=1)):(this.aBubblePos[o].vx=r*Math.cos(userBubble.hitAngle),this.aBubblePos[o].vy=r*Math.sin(userBubble.hitAngle),this.aBubblePos[o].inc=0,this.aBubblePos[o].dist=r/2.5)}if(0<this.aToRemove.length)for(o=0;o<this.aToRemove.length;o++)for(var n=0;n<this.aBubblePos.length;n++)this.aToRemove[o].id==this.aBubblePos[n].id&&0==this.aBubblePos[n].state&&(h=(this.aToRemove[o].x-this.aBubblePos[n].x)*(this.aToRemove[o].x-this.aBubblePos[n].x)+(this.aToRemove[o].y-this.aBubblePos[n].y)*(this.aToRemove[o].y-this.aBubblePos[n].y))<s&&(this.aBubblePos[n].state=this.aToRemove.length+1,this.aToRemove.push(this.aBubblePos[n]));this.aToRemove.push({id:t,x:a,y:e})},a.prototype.findMatchingConnectingBubbles=function(t,a,e){for(var i=2*ballRadius*(2*ballRadius)+50,s=0;s<this.aBubblePos.length;s++){this.aBubblePos[s].float=1;var o=(a-this.aBubblePos[s].x)*(a-this.aBubblePos[s].x)+(e-this.aBubblePos[s].y)*(e-this.aBubblePos[s].y),h=Math.atan2(e-this.aBubblePos[s].y,a-this.aBubblePos[s].x),l=Math.max(2e4-o,0)/500;this.aBubblePos[s].vx=l*Math.cos(h),this.aBubblePos[s].vy=l*Math.sin(h),this.aBubblePos[s].inc=0,this.aBubblePos[s].dist=l/2.5,this.aBubblePos[s].range=Math.sqrt(o)/25,a!=this.aBubblePos[s].x||e!=this.aBubblePos[s].y?o<i&&(this.aBubblePos[s].id==t?(this.aToRemove.push(this.aBubblePos[s]),this.aBubblePos[s].state=1):4<this.aBubblePos[s].id&&8!=this.aBubblePos[s].id&&!(9<this.aBubblePos[s].id&&this.aBubblePos[s].id<15)&&(this.aSpecials.push(this.aBubblePos[s]),this.aBubblePos[s].state=1)):(this.aBubblePos[s].vx=l*Math.cos(userBubble.hitAngle),this.aBubblePos[s].vy=l*Math.sin(userBubble.hitAngle),this.aBubblePos[s].inc=0,this.aBubblePos[s].dist=l/2.5)}if(0<this.aToRemove.length)for(s=0;s<this.aToRemove.length;s++)for(var r=0;r<this.aBubblePos.length;r++)this.aToRemove[s].id==this.aBubblePos[r].id&&0==this.aBubblePos[r].state&&(o=(this.aToRemove[s].x-this.aBubblePos[r].x)*(this.aToRemove[s].x-this.aBubblePos[r].x)+(this.aToRemove[s].y-this.aBubblePos[r].y)*(this.aToRemove[s].y-this.aBubblePos[r].y),this.aToRemove[s].x,this.aToRemove[s].x,this.aToRemove[s].y,this.aToRemove[s].y,o<i)&&(this.aBubblePos[r].state=1,this.aToRemove.push(this.aBubblePos[r]));this.aToRemove.push({id:t,x:a,y:e})},a.prototype.findFloatingBubbles=function(){new Array;for(var t=0;t<this.aBubblePos.length;t++)this.aBubblePos[t].y==ballRadius&&0==this.aBubblePos[t].state&&(this.aBubblePos[t].float=0,this.findAnyConnectingBubbles(this.aBubblePos[t].x,this.aBubblePos[t].y))},a.prototype.findAnyConnectingBubbles=function(t,a){for(var e=2*ballRadius*(2*ballRadius)+50,i=new Array,s=0;s<this.aBubblePos.length;s++)t==this.aBubblePos[s].x&&a==this.aBubblePos[s].y||0!=this.aBubblePos[s].state||(t-this.aBubblePos[s].x)*(t-this.aBubblePos[s].x)+(a-this.aBubblePos[s].y)*(a-this.aBubblePos[s].y)<e&&(this.aBubblePos[s].float=0,i.push(this.aBubblePos[s]));if(0<i.length)for(s=0;s<i.length;s++)for(var o=0;o<this.aBubblePos.length;o++)1==this.aBubblePos[o].float&&0==this.aBubblePos[o].state&&(i[s].x-this.aBubblePos[o].x)*(i[s].x-this.aBubblePos[o].x)+(i[s].y-this.aBubblePos[o].y)*(i[s].y-this.aBubblePos[o].y)<e&&(this.aBubblePos[o].float=0,i.push(this.aBubblePos[o]))},a.prototype.removeBubbles=function(t,a){this.aToRemove.length>this.praiseTarg&&(displayInGameText("praise"+Math.floor(3*Math.random()),.5),playSound("praise"),this.praiseTarg+=5);for(var e=0;e<this.aBubblePos.length;e++)if(0!=this.aBubblePos[e].state||1==this.aBubblePos[e].float){0!=this.aBubblePos[e].state?addPop(this.aBubblePos[e].x,this.aBubblePos[e].y,this.aBubblePos[e].range,this.aBubblePos[e].id):addFallingBubble(this.aBubblePos[e].id,this.aBubblePos[e].x,this.aBubblePos[e].y+this.ceiling);for(var i=0;i<aGlints.length;i++)aGlints[i].bubbleTargId==e&&aGlints[i].resetInGame();this.aBubblePos.splice(e,1),--e}},a.prototype.ceilingMoved=function(){if(1==aLevelData[levelNum]["@levelType"]){for(var t=10,a=0;a<this.aBubblePos.length;a++)this.aBubblePos[a].y==ballRadius&&t--;if(aLevelSpecificTarget[0]=t,aLevelSpecificTarget[0]>=aLevelSpecificTarget[1])return void initLevelCompleteSequence()}else if(2==aLevelData[levelNum]["@levelType"]){var t=aLevelSpecificTarget[1],e=!1;aLevelSpecificTarget[0]!=aLevelSpecificTarget[1]-1&&(e=!0);for(a=0;a<this.aBubblePos.length;a++)9<this.aBubblePos[a].id&&this.aBubblePos[a].id<15&&t--;if(aLevelSpecificTarget[0]=t,aLevelSpecificTarget[0]>=aLevelSpecificTarget[1])return void initLevelCompleteSequence();e&&aLevelSpecificTarget[0]==aLevelSpecificTarget[1]-1&&displayInGameText("oneLeft",.5)}firstPop=!0,gameTouchState=0,launcher.render(),0!=aLevelData[levelNum]["@bLimit"]&&gameIsInPlay&&0==bubblesToFire&&initLevelFailSequence(),userBubble.reset()},a.prototype.getLowestBubbleY=function(){for(var t=0,a=0;a<this.aBubblePos.length;a++)this.aBubblePos[a].y>t&&(t=this.aBubblePos[a].y);return t},a.prototype.getAllFreePos=function(){this.aFreePos=new Array;for(var t=wallDepth+ballRadius+ballRadius,a=0;a<9;a++){for(var e=new Array(1,1),i=0;i<this.aBubblePos.length;i++)wallDepth+ballRadius<t&&(t-ballRadius!=this.aBubblePos[i].x||0!=this.aBubblePos[i].y)||(e[0]=0),(!(t<canvas.width-(wallDepth+ballRadius))||t+ballRadius==this.aBubblePos[i].x&&0==this.aBubblePos[i].y)&&(e[1]=0);1==e[0]&&this.aFreePos.push({posX:t-ballRadius,posY:ballRadius,targX:t-ballRadius/2,targY:ballRadius}),1==e[0]&&this.aFreePos.push({posX:t+ballRadius,posY:ballRadius,targX:t+ballRadius/2,targY:ballRadius}),t+=2*ballRadius}aAllowedBubbleStates=new Array(0,0,0,0,0);for(a=0;a<this.aBubblePos.length;a++){for(e=new Array(1,1,1,1),i=0;i<this.aBubblePos.length;i++)this.aBubblePos[a].y!=ballRadius&&this.aBubblePos[a].x>wallDepth+2*ballRadius&&(this.aBubblePos[a].x-2*ballRadius!=this.aBubblePos[i].x||this.aBubblePos[a].y!=this.aBubblePos[i].y)||(e[0]=0),this.aBubblePos[a].x>wallDepth+ballRadius&&(this.aBubblePos[a].x-ballRadius!=this.aBubblePos[i].x||this.aBubblePos[a].y+1.75*ballRadius!=this.aBubblePos[i].y)||(e[1]=0),this.aBubblePos[a].x<canvas.width-(wallDepth+ballRadius)&&(this.aBubblePos[a].x+ballRadius!=this.aBubblePos[i].x||this.aBubblePos[a].y+1.75*ballRadius!=this.aBubblePos[i].y)||(e[2]=0),(!(this.aBubblePos[a].y!=ballRadius&&this.aBubblePos[a].x<canvas.width-(wallDepth+2*ballRadius))||this.aBubblePos[a].x+2*ballRadius==this.aBubblePos[i].x&&this.aBubblePos[a].y==this.aBubblePos[i].y)&&(e[3]=0);1==e[0]&&this.aFreePos.push({posX:this.aBubblePos[a].x-2*ballRadius,posY:this.aBubblePos[a].y,targX:this.aBubblePos[a].x-2*ballRadius/2*this.freePosAdjust,targY:this.aBubblePos[a].y}),1==e[1]&&this.aFreePos.push({posX:this.aBubblePos[a].x-ballRadius,posY:this.aBubblePos[a].y+1.75*ballRadius,targX:this.aBubblePos[a].x-ballRadius/2*this.freePosAdjust,targY:this.aBubblePos[a].y+1.75*ballRadius/2*this.freePosAdjust}),1==e[2]&&this.aFreePos.push({posX:this.aBubblePos[a].x+ballRadius,posY:this.aBubblePos[a].y+1.75*ballRadius,targX:this.aBubblePos[a].x+ballRadius/2*this.freePosAdjust,targY:this.aBubblePos[a].y+1.75*ballRadius/2*this.freePosAdjust}),1==e[3]&&this.aFreePos.push({posX:this.aBubblePos[a].x+2*ballRadius,posY:this.aBubblePos[a].y,targX:this.aBubblePos[a].x+2*ballRadius/2*this.freePosAdjust,targY:this.aBubblePos[a].y}),this.aBubblePos[a].id<5&&(aAllowedBubbleStates[this.aBubblePos[a].id]=!0)}for(var s=!0,a=0;a<aAllowedBubbleStates.length;a++)aAllowedBubbleStates[a]&&(s=!1);s&&(aAllowedBubbleStates=new Array(1,1,1,1,1))},a.prototype.update=function(){},a.prototype.render=function(){var t,a,e,i=this.hasRemoved?(e=10,1.5):(e=5,.75);if(1==aLevelData[levelNum]["@levelType"])for(var s=0;s<10;s++){var o=16*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,h=Math.floor(16/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,o,h,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,wallDepth+ballRadius-this.oBubblesImgData.oData.spriteWidth/2+2*ballRadius*s,this.ceiling+ballRadius-this.oBubblesImgData.oData.spriteHeight/2,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight)}for(s=0;s<this.aBubblePos.length;s++){this.aBubblePos[s].inc<e?(this.aBubblePos[s].inc+=this.aBubblePos[s].dist*delta,t=this.aBubblePos[s].vx*(this.aBubblePos[s].inc/e)*(this.aBubblePos[s].inc/e-2)+this.aBubblePos[s].vx,a=this.aBubblePos[s].vy*(this.aBubblePos[s].inc/e)*(this.aBubblePos[s].inc/e-2)+this.aBubblePos[s].vy):(a=t=0,this.aBubblePos[s].inc=e);o=this.aBubblePos[s].id*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,h=Math.floor(this.aBubblePos[s].id/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,o,h,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,this.aBubblePos[s].x-this.oBubblesImgData.oData.spriteWidth/2-Math.sin(this.aBubblePos[s].inc)*(t*i),this.ceiling+this.aBubblePos[s].y-this.oBubblesImgData.oData.spriteHeight/2-Math.sin(this.aBubblePos[s].inc)*(a*i),this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight)}},t.BubbleStack=a}(Elements=Elements||{}),function(t){function a(){this.x=0,this.y=0,this.removeMe=!1,this.flickerInc=0,this.flickerIncTarg=.2*Math.random()+.05,this.bounceInc=0,this.flipX=1,this.state=0,this.flashInc=0,this.scale=1,this.fallSpeed=1e3,this.oBubblesImgData=assetLib.getData("bubbles"),this.reset(),this.y=Math.random()*canvas.height}a.prototype.reset=function(){this.id=Math.floor(5*Math.random()),this.x=50+Math.random()*(canvas.width-100),this.y=-50-300*Math.random(),this.vx=100*Math.random()-50,this.vy=150*Math.random()+200},a.prototype.update=function(){this.x+=this.vx*delta,this.y+=this.vy*delta,this.x>canvas.width-(wallDepth+ballRadius)?(this.x=canvas.width-(wallDepth+ballRadius),this.vx*=-1):this.x<wallDepth+ballRadius&&(this.x=wallDepth+ballRadius,this.vx*=-1),this.y>canvas.height+50&&this.reset()},a.prototype.render=function(){var t=this.id*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(this.id/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,this.x-this.oBubblesImgData.oData.spriteWidth/2*this.scale,this.y-this.oBubblesImgData.oData.spriteHeight/2*this.scale,this.oBubblesImgData.oData.spriteWidth*this.scale,this.oBubblesImgData.oData.spriteHeight*this.scale)},t.BasicFallingBubble=a}(Elements=Elements||{}),function(t){function a(t,a,e){this.x=0,this.y=0,this.removeMe=!1,this.flickerInc=0,this.flickerIncTarg=.2*Math.random()+.05,this.bounceInc=0,this.flipX=1,this.state=0,this.flashInc=0,this.scale=1,this.fallSpeed=1e3,this.oBubblesImgData=assetLib.getData("bubbles");var i=200*Math.random()+400;null==t?(t=360*Math.random()*radian,i=100*Math.random()+100):t+=(10*Math.random()-5)*radian,this.flashIncTarg=null==a?0:(a-1)/20,this.vx=-i*Math.cos(t),this.vy=-i*Math.sin(t),9<e&&e<15&&(e+=7,this.scale=3,TweenLite.to(this,2,{scale:1.5,ease:"Elastic.easeOut"}),this.vy=-100,this.fallSpeed=500),this.setId(e),this.vTween=TweenLite.to(this,3,{vx:.25*this.vx,ease:"Quad.easeOut"})}a.prototype.setId=function(t){this.flickerId=this.id=t},a.prototype.update=function(){0==this.state?(this.flashInc+=delta,this.flashInc>=this.flashIncTarg&&(this.state=1)):(this.x+=this.vx*delta*this.flipX,this.vy+=this.fallSpeed*delta,this.y+=this.vy*delta,this.x>canvas.width-(wallDepth+ballRadius)?(this.x=canvas.width-(wallDepth+ballRadius),this.flipX*=-1):this.x<wallDepth+ballRadius&&(this.x=wallDepth+ballRadius,this.flipX*=-1),this.bounceInc<0&&this.y>600-ballRadius&&(this.bounceInc++,this.y=600-ballRadius,this.vy*=-.5),this.y>canvas.height+50&&(this.removeMe=!0))},a.prototype.render=function(){var t=this.id*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(this.id/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight;ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,this.x-this.oBubblesImgData.oData.spriteWidth/2*this.scale,this.y-this.oBubblesImgData.oData.spriteHeight/2*this.scale,this.oBubblesImgData.oData.spriteWidth*this.scale,this.oBubblesImgData.oData.spriteHeight*this.scale)},t.FallingBubble=a}(Elements=Elements||{});var Elements,Utils,previousTime,canvasX,canvasY,canvasScaleX,canvasScaleY,sound,music,splash,assetLib,preAssetLib,delta,textDisplay,__extends=this.__extends||function(t,a){function e(){this.constructor=t}e.prototype=a.prototype,t.prototype=new e},requestAnimFrame=(!function(t){a=Utils.AnimSprite,__extends(i,a),i.prototype.update=function(){this.vy+=150*delta,this.y+=this.vy*delta,a.prototype.updateAnimation.call(this,delta)},i.prototype.render=function(){a.prototype.renderSimple.call(this,ctx)};var a,e=i;function i(t){a.call(this,assetLib.getData("firework"+t),30,30,"explode"),this.vy=0,this.setAnimType("once","explode"),this.animEndedFunc=function(){this.removeMe=!0};t=1==t?4:3;TweenLite.to(this,1,{scaleX:t,scaleY:t,ease:"Quad.easeOut"})}t.Firework=e}(Elements=Elements||{}),!function(t){function a(t,a){this.x=0,this.y=0,this.scale=0,this.inc=0,this.canShow=!0,this.oGameElementsImgData=assetLib.getData("gameElements"),this.id=t,TweenLite.to(this,1,{scale:4,ease:"Quad.easeOut"}),"game"==a?this.resetInGame():"map"==a&&this.resetInMap()}a.prototype.resetInGame=function(){bubbleStack.aBubblePos.length/4>this.id?(this.bubbleTargId=Math.floor(Math.random()*bubbleStack.aBubblePos.length),this.incRate=3*Math.random()+1,this.canShow=!0):this.canShow=!1},a.prototype.resetInMap=function(){this.incRate=3*Math.random()+1,this.canShow=!0,this.targX=400*Math.random()+25,this.targY=1200*Math.random()+100},a.prototype.updateInGame=function(){bubbleStack.aBubblePos[this.bubbleTargId]?(this.x=bubbleStack.aBubblePos[this.bubbleTargId].x+3,this.y=bubbleStack.aBubblePos[this.bubbleTargId].y-13+bubbleStack.ceiling,this.inc+=this.incRate*delta,this.scale=2*Math.sin(this.inc),3.14<this.inc&&(this.inc=0,this.resetInGame())):(this.resetInGame(),this.canShow=!1)},a.prototype.updateInMap=function(){this.x=this.targX,this.y=this.targY-panel.mapPosRealY,this.inc+=this.incRate*delta,this.scale=1.5*Math.sin(this.inc),3.14<this.inc&&(this.inc=0,this.resetInMap())},a.prototype.render=function(){var t,a,e,i;this.canShow&&(t=this.oGameElementsImgData.oData.oAtlasData[oImageIds.glint].x,a=this.oGameElementsImgData.oData.oAtlasData[oImageIds.glint].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds.glint].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds.glint].height,ctx.drawImage(this.oGameElementsImgData.img,t,a,e,i,this.x-e/2*this.scale,this.y-i/2*this.scale,e*this.scale,i*this.scale))},t.Glint=a}(Elements=Elements||{}),!function(t){s=Utils.AnimSprite,__extends(e,s),e.prototype.startAnim=function(){playSound("pop"+Math.floor(4*Math.random())),this.bubbleId=Math.min(this.bubbleId,5),this.setAnimType("once","explode"+this.bubbleId),this.explodeStage=1,this.animEndedFunc=function(){this.startY=this.y,this.explodeStage=2,this.scaleX=0,this.scaleY=0,TweenLite.to(this,.5,{scaleX:1,scaleY:1,ease:"Back.easeOut"})}},e.prototype.update=function(){1==this.explodeStage?(this.offsetY=bubbleStack.ceiling,s.prototype.updateAnimation.call(this,delta)):2==this.explodeStage&&(this.incY+=7*delta,this.y=this.startY+5*Math.sin(this.incY+this.x+this.startY),8<this.incY)&&(TweenLite.to(this,1,{x:canvas.width/2,y:-300,scaleX:0,scaleY:0,ease:"Back.easeIn",onComplete:function(t){t.removeMe=!0},onCompleteParams:[this]}),this.explodeStage=3)},e.prototype.render=function(){var t,a,e,i;0==this.explodeStage?(t=this.bubbleId*this.oBubblesImgData.oData.spriteWidth%this.oBubblesImgData.img.width,a=Math.floor(this.bubbleId/(this.oBubblesImgData.img.width/this.oBubblesImgData.oData.spriteWidth))*this.oBubblesImgData.oData.spriteHeight,ctx.drawImage(this.oBubblesImgData.img,t,a,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight,this.x-this.oBubblesImgData.oData.spriteWidth/2,this.y-this.oBubblesImgData.oData.spriteHeight/2+bubbleStack.ceiling,this.oBubblesImgData.oData.spriteWidth,this.oBubblesImgData.oData.spriteHeight)):1==this.explodeStage?s.prototype.renderSimple.call(this,ctx):2!=this.explodeStage&&3!=this.explodeStage||(t=this.oGameElementsImgData.oData.oAtlasData[oImageIds["score"+this.score]].x,a=this.oGameElementsImgData.oData.oAtlasData[oImageIds["score"+this.score]].y,e=this.oGameElementsImgData.oData.oAtlasData[oImageIds["score"+this.score]].width,i=this.oGameElementsImgData.oData.oAtlasData[oImageIds["score"+this.score]].height,ctx.drawImage(this.oGameElementsImgData.img,t,a,e,i,this.x-e/2*this.scaleX,this.y-i/2*this.scaleY+bubbleStack.ceiling,e*this.scaleX,i*this.scaleY))};var s,a=e;function e(t,a,e){s.call(this,assetLib.getData("pop"),20,10,"hide"),this.explodeStage=0,this.incY=0,this.oBubblesImgData=assetLib.getData("bubbles"),this.oGameElementsImgData=assetLib.getData("gameElements"),this.bubbleId=a,this.score=e;var i=this;setTimeout(function(){i.startAnim()},50*(t-1))}t.Pop=a}(Elements=Elements||{}),!function(t){a=Utils.AnimSprite,__extends(i,a),i.prototype.update=function(){a.prototype.updateAnimation.call(this,delta)},i.prototype.render=function(){a.prototype.renderSimple.call(this,ctx)};var a,e=i;function i(){a.call(this,assetLib.getData("flame"),12,10,"burn"),this.x=170,this.y=550}t.Flame=e}(Elements=Elements||{}),!function(t){function a(t){this.dataGroupNum=2,this.saveDataId=t,window.famobi=window.famobi||{},window.famobi.localStorage=window.famobi.localStorage||window.localStorage,window.famobi.sessionStorage=window.famobi.sessionStorage||window.sessionStorage,this.clearData(),this.setInitialData()}a.prototype.clearData=function(){this.aLevelStore=new Array,this.aLevelStore.push(1),this.aLevelStore.push(0);for(var t=0;t<aMapButs.length-1;t++)this.aLevelStore.push(0),this.aLevelStore.push(0)},a.prototype.resetData=function(){window.famobi_analytics.trackEvent("EVENT_CUSTOM",{event:"EVENT_RESETDATA"}).then(function(){this.clearData(),this.saveData()}.bind(this))},a.prototype.setInitialData=function(){if(null!=window.famobi.localStorage.getItem(this.saveDataId)&&""!=window.famobi.localStorage.getItem(this.saveDataId))for(var t in this.aLevelStore=window.famobi.localStorage.getItem(this.saveDataId).split(","),this.aLevelStore)this.aLevelStore[t]=parseInt(this.aLevelStore[t]);else this.saveData()},a.prototype.setData=function(t,a,e){e>this.aLevelStore[2*t+1]&&(this.aLevelStore[2*t+1]=e),a+1>this.aLevelStore[2*t]&&(this.aLevelStore[2*t]=a+1),t<aMapButs.length-1&&0==this.aLevelStore[2*(t+1)]&&(this.aLevelStore[2*(t+1)]=1)},a.prototype.getStars=function(t){return this.aLevelStore[2*t]},a.prototype.getTotalScore=function(){for(var t=0,a=0;a<saveDataHandler.aLevelStore.length;a++)t+=saveDataHandler.aLevelStore[a+1],a++;return t},a.prototype.getScore=function(t){return this.aLevelStore[2*t+1]},a.prototype.saveData=function(){for(var t="",a=0;a<this.aLevelStore.length;a++)t+=this.aLevelStore[a],a<this.aLevelStore.length-1&&(t+=",");window.famobi.localStorage.setItem(this.saveDataId,t)},t.SaveDataHandler=a}(Utils=Utils||{}),!function(t){function a(){this.oTextData={},this.inc=0,this.kernOffset=1,this.createTextObjects()}a.prototype.createTextObjects=function(){for(var t in assetLib.textData.langText.text[curLang])this.oTextData[t]={},this.oTextData[t].aLineData=this.getCharData(window.famobi.__(t)["@text"],window.famobi.__(t)["@fontId"]),this.oTextData[t].aLineWidths=this.getLineWidths(this.oTextData[t].aLineData),this.oTextData[t].blockWidth=this.getBlockWidth(this.oTextData[t].aLineData),this.oTextData[t].blockHeight=this.getBlockHeight(this.oTextData[t].aLineData,window.famobi.__(t)["@fontId"]),this.oTextData[t].lineHeight=parseInt(assetLib.textData["fontData"+window.famobi.__(t)["@fontId"]].text.common["@lineHeight"]),this.oTextData[t].oFontImgData=assetLib.getData("font"+window.famobi.__(t)["@fontId"])},a.prototype.getLineWidths=function(t){for(var a=new Array,e=0;e<t.length;e++){for(var i=0,s=0;s<t[e].length;s++)i+=parseInt(t[e][s]["@xadvance"])+this.kernOffset,0==s?i-=parseInt(t[e][s]["@xoffset"]):s==t[e].length-1&&(i+=parseInt(t[e][s]["@xoffset"]));a.push(i)}return a},a.prototype.getBlockWidth=function(t){for(var a=0,e=0;e<t.length;e++){for(var i=0,s=0;s<t[e].length;s++)i+=parseInt(t[e][s]["@xadvance"])+this.kernOffset,0==s?i-=parseInt(t[e][s]["@xoffset"]):s==t[e].length-1&&(i+=parseInt(t[e][s]["@xoffset"]));a<i&&(a=i)}return a},a.prototype.getBlockHeight=function(t,a){return t.length*parseInt(assetLib.textData["fontData"+a].text.common["@lineHeight"])},a.prototype.getCharData=function(t,a){for(var e=new Array,i=0;i<t.length;i++){e[i]=new Array;for(var s=0;s<t[i].length;s++)for(var o=0;o<assetLib.textData["fontData"+a].text.chars.char.length;o++)t[i][s].charCodeAt()==assetLib.textData["fontData"+a].text.chars.char[o]["@id"]&&e[i].push(assetLib.textData["fontData"+a].text.chars.char[o])}return e},a.prototype.renderText=function(t){var a,e=this.oTextData[t.text].aLineData,i=this.oTextData[t.text].oFontImgData,s=0,o=0,h=0,l=1,r=0,n=(t.lineOffsetY&&(h=t.lineOffsetY),+(l=t.scale?t.scale:l));t.maxWidth&&this.oTextData[t.text].blockWidth*l>t.maxWidth&&(n=t.maxWidth/this.oTextData[t.text].blockWidth),t.anim&&(this.inc+=7*delta);for(var u=0;u<e.length;u++){"centre"==t.alignX&&(s=this.oTextData[t.text].aLineWidths[u]/2),"centre"==t.alignY&&(o=this.oTextData[t.text].blockHeight/2+h*(e.length-1)/2);for(var m=a=0;m<e[u].length;m++){var g=e[u][m]["@x"],d=e[u][m]["@y"],b=e[u][m]["@width"],c=e[u][m]["@height"];t.anim&&(r=Math.sin(this.inc+m/2)*(c/10*n)),ctx.drawImage(i.img,g,d,b,c,t.x+(a+parseInt(e[u][m]["@xoffset"])-s)*n,t.y+(parseInt(e[u][m]["@yoffset"])+u*this.oTextData[t.text].lineHeight+u*h-o)*n+r,b*n,c*n),a+=parseInt(e[u][m]["@xadvance"])+this.kernOffset}}},t.TextDisplay=a}(Utils=Utils||{}),window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60,(new Date).getTime())}),canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),div=(canvas.width=450,canvas.height=700,document.getElementById("canvas-wrapper")),audioType=0,muted=!1,splashTimer=0,rotatePause=!1,manualPause=!1,isMobile=!1,gameState="loading",aLangs=new Array("EN"),curLang="",isBugBrowser=!1,isIE10=!1,radian=Math.PI/180,ios9FirstTouch=!1,deviceAgent=(navigator.userAgent.match(/MSIE\s([\d]+)/)&&(isIE10=!0),navigator.userAgent.toLowerCase()),userInput=((deviceAgent.match(/(iphone|ipod|ipad)/)||deviceAgent.match(/(android)/)||deviceAgent.match(/(iemobile)/)||deviceAgent.match(/iphone/i)||deviceAgent.match(/ipad/i)||deviceAgent.match(/ipod/i)||deviceAgent.match(/blackberry/i)||deviceAgent.match(/bada/i))&&(isMobile=!0,deviceAgent.match(/(android)/))&&!/Chrome/.test(navigator.userAgent)&&(isBugBrowser=!0),new Utils.UserInput(canvas,isBugBrowser));function visibleResume(){muted||manualPause||Howler.unmute()}function visiblePause(){Howler.mute()}function isStock(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&parseFloat(t[1])<537}resizeCanvas(),window.onresize=function(){setTimeout(function(){resizeCanvas()},1)},window.addEventListener("load",function(){setTimeout(function(){resizeCanvas()},0),window.addEventListener("orientationchange",function(){setTimeout(function(){resizeCanvas()},500),setTimeout(function(){resizeCanvas()},2e3)},!1)});var panel,hud,background,aLevelUps,levelBonusScore,bonusScore,panelFrame,oLogoBut,musicTween,userBubble,launcher,bubbleStack,gameTouchState,aimX,aimY,aimRot,bubbleTarget,aFallingBubbles,aEffects,aGlints,curPopChain,aimClickStartY,bubbleTargNum,bubbleTargId,bubblesToFire,gameControlState,inGameText,animTextY,startPanelInc,topSpacesFilled,aLevelSpecificTarget,aStarMarkers,starBarLength,messageTween,firstPop,gameIsInPlay,aAllowedBubbleStates,curStarLevel,flame,ua=navigator.userAgent,isSharpStock=/SHL24|SH-01F/i.test(ua)&&isStock(),isXperiaAStock=/SO-04E/i.test(ua)&&isStock(),isFujitsuStock=/F-01F/i.test(ua)&&isStock(),totalScore=(!isIE10&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext||-1==navigator.userAgent.indexOf("Android")||isSharpStock||isXperiaAStock||isFujitsuStock)?(audioType=1,sound=new Howl({urls:["audio/sound.ogg","audio/sound.m4a"],sprite:{click:[0,450],explode0:[500,800],explode1:[1500,800],explode2:[2500,800],explode3:[3500,800],gemRelease:[4500,1400],levelSuccess:[6e3,1900],pop0:[8e3,300],pop1:[8500,300],pop2:[9e3,300],pop3:[9500,300],switchBubbles:[1e4,400],startLevel:[10500,2e3],levelFail:[13e3,1200],fire0:[14500,600],fire1:[15500,600],fire2:[16500,600],fire3:[17500,600],bonusBubble:[18500,2e3],starProgress:[21e3,1600],bounce:[23e3,500],praise:[24e3,1300]}}),music=new Howl({urls:["audio/music.ogg","audio/music.m4a"],volume:.01,loop:!0})):audioType=0,0),levelScore=0,levelNum=0,aTutorials=new Array,oLogoData={},oImageIds={},bubbleStartX=canvas.width/2,bubbleStartY=530,testVar="------",ballRadius=20,wallDepth=25,aimingFlipped=!1,aPopScores=new Array(10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100),aMapButs=new Array([248,1342],[321,1325],[394,1294],[374,1233],[299,1224],[221,1245],[147,1255],[75,1230],[51,1169],[112,1128],[187,1117],[259,1112],[329,1099],[384,1053],[399,994],[350,946],[279,966],[210,953],[158,906],[146,841],[109,785],[70,732],[69,669],[101,611],[166,626],[211,678],[273,712],[341,691],[384,641],[392,579],[394,516],[395,454],[392,392],[373,329],[304,312],[259,361],[198,394],[129,396],[83,347],[96,283],[158,239],[233,221],[308,223],[382,207],[404,144],[360,94],[292,70],[215,62],[142,63],[73,78]),aLevelData=new Array,saveDataHandler=new Utils.SaveDataHandler("magicbubblesv3");function initSplash(){window.famobi_analytics.trackScreen("SCREEN_SPLASH"),gameState="splash",resizeCanvas(),window.famobi_onPauseRequested=function(){window.famobi_unmuteAfterPause=!muted,muted||toggleMute(!0)},window.famobi_onResumeRequested=function(){window.famobi_unmuteAfterPause&&muted&&toggleMute(!0),window.famobi_unmuteAfterPause=!1},window.famobi.localStorage.getItem("muted")&&toggleMute(!(muted=!1)),1!=audioType||muted||music.play(),textDisplay=new Utils.TextDisplay,aLevelData=assetLib.textData.levelData.text,totalScore=saveDataHandler.getTotalScore(),initStartScreen()}function initStartScreen(){gameState="start",window.famobi_analytics.trackScreen(famobi_analytics.SCREEN_HOME),userInput.removeHitArea("moreGames"),muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,1,{volume:.2,ease:"Linear.easeNone"})),totalScore=saveDataHandler.getTotalScore(),(background=new Elements.Background).renderState="ripple",background.setBackground(0),aFallingBubbles=new Array;for(var t=0;t<10;t++){var a=new Elements.BasicFallingBubble;aFallingBubbles.push(a)}userInput.addHitArea("mute",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0);var e={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2,500],id:oImageIds.bigPlayBut},i={oImgData:assetLib.getData("uiButs"),aPos:[72,650],id:oImageIds.infoBut,noMove:!0},s={oImgData:assetLib.getData("moreGamesBut"),aPos:[350,650],id:"none",scale:.28,noMove:!0},o=(userInput.addHitArea("startScreenPlayBut",butEventHandler,{multiTouch:!0},"image",e),userInput.addHitArea("moreGames",butEventHandler,null,"image",s),new Array(e,i,s));window.famobi.hasFeature("credits")?userInput.addHitArea("credits",butEventHandler,null,"image",i):o=new Array(e,s),(panel=new Elements.Panel(gameState,o)).startTween1(),previousTime=(new Date).getTime(),updateStartScreenEvent()}function initMapScreen(){gameState="map",window.famobi_analytics.trackScreen(famobi_analytics.SCREEN_LEVELSELECT),muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,.5,{volume:.2,ease:"Linear.easeNone"})),totalScore=saveDataHandler.getTotalScore(),userInput.addHitArea("mute",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0);var t={oImgData:assetLib.getData("uiButs"),aPos:[72,650],id:oImageIds.backBut,noMove:!0},t=(userInput.addHitArea("backFromMap",butEventHandler,null,"image",t),new Array(t)),a=(panel=new Elements.Panel(gameState,t),1400);userInput.addHitArea("mapTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0),panel.mapDragY=1e4,panel.mapButIdToHighlight=-1;for(var e=0;e<aMapButs.length;e++)aMapButs[e][1]<a&&0<saveDataHandler.getStars(e)&&(a=aMapButs[e][1]),1==saveDataHandler.getStars(e)&&0==saveDataHandler.getScore(e)&&(panel.mapButIdToHighlight=e);panel.mapPosY=panel.mapPosRealY=Math.max(Math.min(a-canvas.height/2,1400-canvas.height),0),panel.startTween1(),aGlints=new Array;for(e=0;e<5;e++){var i=new Elements.Glint(e,"map");aGlints.push(i)}previousTime=(new Date).getTime(),updateMapScreenEvent()}function initCreditsScreen(){gameState="credits",window.famobi_analytics.trackScreen(famobi_analytics.SCREEN_CREDITS),userInput.addHitArea("mute",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0);var t={oImgData:assetLib.getData("uiButs"),aPos:[72,650],id:oImageIds.backBut},a={oImgData:assetLib.getData("uiButs"),aPos:[72,50],id:oImageIds.resetBut,noMove:!0},t=(userInput.addHitArea("backFromCredits",butEventHandler,null,"image",t),userInput.addHitArea("resetGame",butEventHandler,null,"image",a),new Array(t,a));(panel=new Elements.Panel(gameState,t)).startTween2(),previousTime=(new Date).getTime(),updateCreditsScreenEvent()}function initGame(t){t?logEvent({event:"LEVEL_RESTART",level:levelNum+1}):logEvent({event:"LEVEL_START",level:levelNum+1}),window.famobi_analytics.trackEvent(t?famobi_analytics.EVENT_LEVELRESTART:famobi_analytics.EVENT_LEVELSTART,{levelName:(levelNum+1).toString()}).then(function(){_initGame()})}function _initGame(){gameState="game",(background=new Elements.Background).renderState="none",levelReset(),previousTime=(new Date).getTime(),updateGameEvent()}function levelReset(t,a){t?window.famobi_analytics.trackEvent(a?famobi_analytics.EVENT_LEVELRESTART:famobi_analytics.EVENT_LEVELSTART,{levelName:(levelNum+1).toString()}).then(function(){_levelReset()}):_levelReset()}function _levelReset(){muted||1!=audioType||(musicTween.kill(),musicTween=TweenLite.to(music,1,{volume:.4,ease:"Linear.easeNone"})),gameTouchState=3,curPopChain=-1,gameIsInPlay=!(curStarLevel=0),levelScore=0,totalScore=saveDataHandler.getTotalScore()-saveDataHandler.getScore(levelNum),gameControlState=!0,aimX=bubbleStartX,aimRot=90*radian,animTextY=-100,firstPop=!(startPanelInc=aimY=0),aAllowedBubbleStates=new Array(0,0,0,0,0);for(var t,a=0;a<aLevelData[levelNum]["@grid"].length;a++)-1!=aLevelData[levelNum]["@grid"][a]&&(t=aLevelData[levelNum]["@grid"][a])<5&&(aAllowedBubbleStates[t]=!0);flame=new Elements.Flame,hud=new Elements.Hud,(panel=new Elements.Panel("startPanel",new Array)).startTween1(),setTimeout(function(){userInput.addHitArea("startPanelTouch",butEventHandler,{multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0),userInput.addHitArea("pause",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0)},1e3),userBubble=new Elements.UserBubble,aFallingBubbles=new Array,(launcher=new Elements.Launcher).x=bubbleStartX,launcher.y=bubbleStartY,bubbleStack=new Elements.BubbleStack(aLevelData[levelNum]["@grid"]),aStarMarkers=new Array,starBarLength=0,aStarMarkers.push(aLevelData[levelNum]["@1Star"]),aStarMarkers.push(aLevelData[levelNum]["@2Star"]),aStarMarkers.push(aLevelData[levelNum]["@3Star"]),background.setBackground(aLevelData[levelNum]["@levelTheme"]),0==aLevelData[levelNum]["@levelType"]?(bubbleTargNum=aLevelData[levelNum]["@bTargNum"],bubbleTargId=aLevelData[levelNum]["@bTargId"]):bubbleTargNum=0,bubblesToFire=0!=aLevelData[levelNum]["@bLimit"]?aLevelData[levelNum]["@bLimit"]-1:0,playSound("startLevel"),aGlints=new Array;for(a=0;a<5;a++){var e=new Elements.Glint(a,"game");aGlints.push(e)}aEffects=new Array,window.famobi_analytics.trackScreen("SCREEN_LEVEL")}function butEventHandler(t,a){switch(t){case"langSelect":curLang=a.lang,ctx.clearRect(0,0,canvas.width,canvas.height),userInput.removeHitArea("langSelect"),(preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.png"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets);break;case"startScreenPlayBut":a.isDown||(playSound("click"),userInput.removeHitArea("startScreenPlayBut"),userInput.removeHitArea("mute"),userInput.removeHitArea("credits"),userInput.removeHitArea("moreGames"),initMapScreen());break;case"backFromMap":playSound("click"),userInput.removeHitArea("mute"),userInput.removeHitArea("backFromMap"),userInput.removeHitArea("mapTouch"),initStartScreen();break;case"mapTouch":if(a.isBeingDragged&&!a.hasLeft)panel.mapPosY=Math.max(Math.min(panel.mapStartY-a.y,1400-canvas.height),0);else if(a.isDown)panel.mapTween&&panel.mapTween.kill(),toggleMapButs(!1),panel.mapStartY=panel.mapPosRealY+a.y,panel.mapDragY=a.y;else if(toggleMapButs(!0),Math.abs(panel.mapDragY-a.y)<10)for(var e=0;e<aMapButs.length;e++)if(0<saveDataHandler.getStars(e)&&a.x>aMapButs[e][0]-22&&a.x<aMapButs[e][0]+22&&a.y+panel.mapPosY>aMapButs[e][1]-22&&a.y+panel.mapPosY<aMapButs[e][1]+22){levelNum=e,userInput.removeHitArea("mute"),userInput.removeHitArea("backFromMap"),userInput.removeHitArea("mapTouch"),initGame();break}break;case"credits":window.famobi.hasFeature("credits")&&(playSound("click"),userInput.removeHitArea("startScreenPlayBut"),userInput.removeHitArea("mute"),userInput.removeHitArea("credits"),userInput.removeHitArea("moreGames"),initCreditsScreen());break;case"backFromCredits":playSound("click"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetGame"),initStartScreen();break;case"resetGame":playSound("click"),userInput.removeHitArea("backFromCredits"),userInput.removeHitArea("resetGame"),saveDataHandler.resetData(),initStartScreen();break;case"moreGames":case"moreGamesPause":playSound("click");try{window.famobi.moreGamesLink()}catch(t){}break;case"switchBubble":a.isDown?(s=hud.nextBubbleId,hud.nextBubbleId=userBubble.id,userBubble.id=s,playSound("switchBubbles"),toggleGameTouch(!1),0==gameTouchState&&(gameTouchState=2)):(toggleGameTouch(!0),gameTouchState=0);break;case"firstGameTouch":a.isDown||(userInput.removeHitArea("firstGameTouch"),userInput.addHitArea("gameTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0));break;case"startPanelTouch":startPanelInc=100,aimX=a.x,aimY=a.y;break;case"gameTouch":if(2<=gameTouchState||a.y>bubbleStartY-ballRadius&&a.y<bubbleStartY+ballRadius&&a.x>bubbleStartX-ballRadius&&a.x<bubbleStartX+ballRadius)toggleHudButs(!(launcher.aimLineAlpha=0));else if(a.isBeingDragged&&!a.hasLeft)0==gameTouchState&&(aimX=a.x,aimY=a.y,launcher.aimLineAlpha=1);else if(a.isDown)aimClickStartY=a.y,0==gameTouchState&&(toggleHudButs(!1),aimX=a.x,aimY=a.y),a.hasLeft?launcher.aimLineAlpha=0:launcher.aimLineAlpha=1;else if(toggleHudButs(!0),0==gameTouchState)return playSound("fire"+Math.floor(4*Math.random())),gameTouchState=2,userBubble.shoot(),void(launcher.aimLineAlpha=0);break;case"mute":manualPause||(playSound("click"),toggleMute());break;case"muteFromPause":playSound("click"),toggleMute();var i=assetLib.getData("uiButs"),s=0,o=(muted&&(s=1),assetLib.getData("uiButs"),canvas.width,oImageIds.muteBut1,i.oData.oAtlasData[oImageIds["muteBut"+s]].x),h=i.oData.oAtlasData[oImageIds["muteBut"+s]].y,l=i.oData.oAtlasData[oImageIds["muteBut"+s]].width,s=i.oData.oAtlasData[oImageIds["muteBut"+s]].height;ctx.drawImage(i.img,o+26,h+12,l-52,s-24,canvas.width/2-70-(l-52)/2,355-(s-24)/2,l-52,s-24);break;case"pause":playSound("click"),toggleManualPause(!0);break;case"resumeFromPause":a.isDown||(playSound("click"),toggleManualPause(!0));break;case"menuFromPause":a.isDown||(playSound("click"),toggleManualPause(),userInput.removeHitArea("pause"),userInput.removeHitArea("firstGameTouch"),userInput.removeHitArea("startPanelTouch"),userInput.removeHitArea("gameTouch"),userInput.removeHitArea("switchBubble"),userInput.removeHitArea("retryFromPause"),userInput.removeHitArea("resumeFromPause"),userInput.removeHitArea("muteFromPause"),userInput.removeHitArea("menuFromPause"),logEvent({event:"LEVEL_QUIT",level:levelNum+1,score:levelScore}),window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:(levelNum+1).toString(),reason:"quit"}).then(initMapScreen));break;case"retryFromPause":a.isDown||(playSound("click"),toggleManualPause(),userInput.removeHitArea("pause"),userInput.removeHitArea("firstGameTouch"),userInput.removeHitArea("startPanelTouch"),userInput.removeHitArea("gameTouch"),userInput.removeHitArea("switchBubble"),userInput.removeHitArea("retryFromPause"),userInput.removeHitArea("resumeFromPause"),userInput.removeHitArea("muteFromPause"),userInput.removeHitArea("menuFromPause"),initGame(!0));break;case"retryLevel":userInput.removeHitArea("retryLevel"),userInput.removeHitArea("nextLevel"),levelReset(!0,!0);break;case"retryFromFail":userInput.removeHitArea("retryFromFail"),userInput.removeHitArea("menuFromFail"),levelReset(!0,!0);break;case"menuFromFail":userInput.removeHitArea("retryFromFail"),userInput.removeHitArea("menuFromFail"),window.famobi_analytics.trackEvent("EVENT_LEVELFAIL",{levelName:(levelNum+1).toString(),reason:"quit"}).then(initMapScreen);break;case"nextLevel":userInput.removeHitArea("retryLevel"),userInput.removeHitArea("nextLevel"),++levelNum>=aLevelData.length?(levelNum=0,initMapScreen()):levelReset(!0)}}function addFallingBubble(t,a,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null),9<t&&t<15&&playSound("gemRelease");i=new Elements.FallingBubble(i,s,t);i.x=a,i.y=e,aFallingBubbles.push(i),0!=aLevelData[levelNum]["@levelType"]||0!=bubbleTargId&&t!=bubbleTargId-1||gameIsInPlay&&--bubbleTargNum<=0&&(bubbleTargNum=0,gameIsInPlay=!1,initLevelCompleteSequence())}function addFirework(t,a,e){t=new Elements.Firework(t);t.x=a,t.y=e,t.scaleX=t.scaleY=1,aEffects.push(t)}function addPop(t,a,e,i){var s=9==i?500:getPopScore(),e=new Elements.Pop(e,i,s);e.x=t,e.y=a,aEffects.push(e),updateScore(s),0!=aLevelData[levelNum]["@levelType"]||0!=bubbleTargId&&i!=bubbleTargId-1||(firstPop?firstPop=!1:gameIsInPlay&&--bubbleTargNum<=0&&(bubbleTargNum=0,gameIsInPlay=!1,initLevelCompleteSequence()))}function initLevelCompleteSequence(){setTimeout(function(){initBubbleRain()},100),muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,.1,{volume:.1,ease:"Linear.easeNone"})),userInput.removeHitArea("pause"),userInput.removeHitArea("gameTouch"),userInput.removeHitArea("switchBubble"),gameControlState=!1,displayInGameText("levelComplete",.3,initLevelComplete),playSound("levelSuccess"),aGlints=new Array}function initLevelComplete(){muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,.5,{volume:.4,ease:"Linear.easeNone"}));function t(){a.scale=.75,e.scale=1,userInput.addHitArea("retryLevel",butEventHandler,null,"image",a),userInput.addHitArea("nextLevel",butEventHandler,null,"image",e)}var a={oImgData:assetLib.getData("uiButs"),aPos:[65,650],id:oImageIds.retryBut,scale:1e-4},e={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2,445],id:oImageIds.nextBut,scale:1e-4},i=new Array(a,e),s=0;starBarLength>=aStarMarkers[2]/aStarMarkers[2]?s=3:starBarLength>=aStarMarkers[1]/aStarMarkers[2]?s=2:starBarLength>=aStarMarkers[0]/aStarMarkers[2]&&(s=1),saveDataHandler.setData(levelNum,s,levelScore),saveDataHandler.saveData(),(panel=new Elements.Panel("endPanel",i)).startTween1();setTimeout(function(){Promise.all([logEvent({event:"LEVEL_PASSED",level:levelNum+1,score:levelScore})]).then(t,t)}.bind(this),1500)}function initLevelFailSequence(){logEvent({event:"LEVEL_FAILED",level:levelNum+1,score:levelScore}),userInput.removeHitArea("pause"),userInput.removeHitArea("gameTouch"),userInput.removeHitArea("switchBubble"),gameControlState=!1,displayInGameText("outOfBubbles",.3,initLevelFail),muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,.1,{volume:.1,ease:"Linear.easeNone"})),playSound("levelFail"),aGlints=new Array}function initLevelFail(){muted||1!=audioType||(musicTween&&musicTween.kill(),musicTween=TweenLite.to(music,.5,{volume:.4,ease:"Linear.easeNone"}));function t(){a.scale=1,e.scale=1,userInput.addHitArea("retryFromFail",butEventHandler,null,"image",a),userInput.addHitArea("menuFromFail",butEventHandler,null,"image",e)}var a={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2-70,450],id:oImageIds.retryBut,scale:1e-4},e={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2+70,450],id:oImageIds.menuBut,scale:1e-4},i=new Array(a,e);(panel=new Elements.Panel("endFailPanel",i)).startTween1();setTimeout(function(){Promise.all([]).then(t,t)}.bind(this),1500)}function initBubbleRain(){for(var t=0;t<bubbleStack.aBubblePos.length;t++)addFallingBubble(bubbleStack.aBubblePos[t].id,bubbleStack.aBubblePos[t].x,bubbleStack.aBubblePos[t].y+bubbleStack.ceiling,null,10*Math.random()),bubbleStack.aBubblePos.splice(t,1),--t}function displayInGameText(t,a,e){void 0===a&&(a=0),void 0===e&&(e=null);var i=this;inGameText=t,animTextY=-100,messageTween&&messageTween.kill(),messageTween=TweenLite.to(this,.4,{animTextY:290,ease:"Back.easeOut",delay:a,onComplete:function(){TweenLite.to(i,.4,{animTextY:-100,delay:.7,ease:"Back.easeIn",onComplete:function(){e&&e()}})}})}function getPopScore(){return aPopScores[Math.min(curPopChain,aPopScores.length-1)]}function toggleHudButs(t){t?(userInput.addHitArea("pause",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0),userInput.addHitArea("switchBubble",butEventHandler,{multiTouch:!0},"rect",{aRect:[48,545,119,663]},!0),userInput.addHitArea("gameTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0)):(userInput.removeHitArea("pause"),userInput.removeHitArea("switchBubble"))}function toggleMapButs(t){t?(userInput.addHitArea("mute",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0),t={oImgData:assetLib.getData("uiButs"),aPos:[55,canvas.height-45],id:oImageIds.backBut,noMove:!0},userInput.addHitArea("backFromMap",butEventHandler,null,"image",t),userInput.addHitArea("mapTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0)):(userInput.removeHitArea("mute"),userInput.removeHitArea("backFromMap"))}function toggleGameTouch(t){t?userInput.addHitArea("gameTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0):(userInput.removeHitArea("firstGameTouch"),userInput.removeHitArea("gameTouch"))}function updateScore(t){levelScore+=t,totalScore+=t,starBarLength=Math.min(levelScore/aStarMarkers[2],1),curStarLevel<3&&starBarLength>=aStarMarkers[curStarLevel]/aStarMarkers[2]&&(playSound("starProgress"),curStarLevel++)}function setAimRot(){var t=bubbleStartX-aimX,a=bubbleStartY-aimY,a=Math.atan2(a,t);bubbleStartY<aimClickStartY?(aimingFlipped=!0,aimRot=Math.max(Math.min(160*radian,a+180*radian),20*radian),aimX>canvas.width/2&&aimRot==160*radian&&(aimRot=20*radian)):(aimRot=Math.max(Math.min(160*radian,a),20*radian),aimingFlipped=!1,aimX>canvas.width/2&&aimRot==20*radian&&(aimRot=160*radian))}function updateGameEvent(){if(!manualPause&&!rotatePause&&"game"==gameState){delta=getDelta(),setAimRot(),background.update(),background.render(),bubbleStack.update(),bubbleStack.render();for(var t=0;t<aGlints.length;t++)aGlints[t].updateInGame(),aGlints[t].render();hud.renderUnder(),flame.update(),flame.render(),launcher.update(),launcher.render(),userBubble.update(),userBubble.render(),hud.renderOver();for(t=0;t<aFallingBubbles.length;t++)aFallingBubbles[t].update(),aFallingBubbles[t].render(),aFallingBubbles[t].removeMe&&(aFallingBubbles.splice(t,1),updateScore(10),--t);for(var a,e,i,s,t=0;t<aEffects.length;t++)aEffects[t].update(),aEffects[t].render(),aEffects[t].removeMe&&(aEffects.splice(t,1),--t);panel.posY<550&&(panel.render(ctx),0<=startPanelInc&&(startPanelInc+=delta),3<startPanelInc&&(startPanelInc=-1,userInput.removeHitArea("startPanelTouch"),panel.tweenOffScreen(function(){userInput.addHitArea("pause",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0),userInput.addHitArea("switchBubble",butEventHandler,{multiTouch:!0},"rect",{aRect:[48,545,119,663]},!0),userInput.addHitArea("gameTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0)})),"endPanel"==panel.panelType)&&Math.random()<.05&&addFirework(Math.floor(2*Math.random()),Math.random()*(canvas.width-200)+100,Math.random()*(canvas.height-200)+100),-50<animTextY&&(s=panel.oGameElementsImgData.oData.oAtlasData[oImageIds.messagePanel].x,a=panel.oGameElementsImgData.oData.oAtlasData[oImageIds.messagePanel].y,e=panel.oGameElementsImgData.oData.oAtlasData[oImageIds.messagePanel].width,i=panel.oGameElementsImgData.oData.oAtlasData[oImageIds.messagePanel].height,ctx.drawImage(panel.oGameElementsImgData.img,s,a,e,i,canvas.width/2-e/2,animTextY-i/2,e,i),s={text:inGameText,x:canvas.width/2,y:animTextY,alignX:"centre",alignY:"centre",scale:1,lineOffsetY:-5,anim:!0,maxWidth:400},textDisplay.renderText(s)),requestAnimFrame(updateGameEvent)}}function updateCreditsScreenEvent(){rotatePause||"credits"!=gameState||(delta=getDelta(),panel.update(delta),panel.render(ctx),renderMuteBut(),requestAnimFrame(updateCreditsScreenEvent))}function updateLevelComplete(){rotatePause||"levelComplete"!=gameState||(delta=getDelta(),background.render(),panel.render(ctx),renderMuteBut(),requestAnimFrame(updateLevelComplete))}function updateGameEndFail(){rotatePause||"gameEndFail"!=gameState||(delta=getDelta(),background.render(),panel.render(ctx),renderMuteBut(),requestAnimFrame(updateGameEndFail))}function updateSplashScreenEvent(){rotatePause||"splash"!=gameState||(delta=getDelta(),2.5<(splashTimer+=delta)?(1!=audioType||muted||music.play(),initStartScreen()):(splash.render(ctx,delta),requestAnimFrame(updateSplashScreenEvent)))}function updateStartScreenEvent(){if(!rotatePause&&"start"==gameState){delta=getDelta(),background.update(),background.render();for(var t=0;t<aFallingBubbles.length;t++)aFallingBubbles[t].update(),aFallingBubbles[t].render();panel.update(delta),panel.render(ctx),renderMuteBut(),requestAnimFrame(updateStartScreenEvent)}}function updateMapScreenEvent(){if(!rotatePause&&"map"==gameState){delta=getDelta(),panel.update(delta),panel.render(ctx),renderMuteBut();for(var t=0;t<aGlints.length;t++)aGlints[t].updateInMap(),aGlints[t].render();requestAnimFrame(updateMapScreenEvent)}}function getDelta(){var t=(new Date).getTime(),a=(t-previousTime)/1e3;return previousTime=t,a=.5<a?0:a}function checkSpriteCollision(t,a){var e=t.x,i=t.y,s=a.x,o=a.y;return(e-s)*(e-s)+(i-o)*(i-o)<t.radius*a.radius}function getScaleImageToMax(t,a){a=t.isSpriteSheet?a[0]/t.oData.spriteWidth<a[1]/t.oData.spriteHeight?Math.min(a[0]/t.oData.spriteWidth,1):Math.min(a[1]/t.oData.spriteHeight,1):a[0]/t.img.width<a[1]/t.img.height?Math.min(a[0]/t.img.width,1):Math.min(a[1]/t.img.height,1);return a}function getCentreFromTopLeft(t,a,e){var i=new Array;return i.push(t[0]+a.oData.spriteWidth/2*e),i.push(t[1]+a.oData.spriteHeight/2*e),i}function loadPreAssets(){if(1<aLangs.length){for(var t=new Array,a=0;a<aLangs.length;a++)t.push({id:"lang"+aLangs[a],file:"images/lang"+aLangs[a]+".png"});(preAssetLib=new Utils.AssetLoader(curLang,t,ctx,canvas.width,canvas.height,!1)).onReady(initLangSelect)}else curLang=aLangs[0],(preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.png"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets)}function initLangSelect(){for(var t,a,e=0,i=0;i<aLangs.length&&(i+1)*+(t=preAssetLib.getData("lang"+aLangs[i])).img.width+10*(i+2)<canvas.width;i++)e++;for(var s=Math.ceil(aLangs.length/e),i=0;i<aLangs.length;i++){t=preAssetLib.getData("lang"+aLangs[i]),o=canvas.width/2-e/2*+t.img.width-(e-1)/2*10,o+=i%e*(+t.img.width+10),a=canvas.height/2-s/2*+t.img.height-(s-1)/2*10,a+=Math.floor(i/e)%s*(+t.img.height+10),ctx.drawImage(t.img,0,0,t.img.width,t.img.height,o,a,+t.img.width,+t.img.height);var o={oImgData:t,aPos:[o+ +t.img.width/2,a+ +t.img.height/2],scale:1,id:"none",noMove:!0};userInput.addHitArea("langSelect",butEventHandler,{lang:aLangs[i]},"image",o)}}function initLoadAssets(){loadAssets()}function loadAssets(){var a;try{a=window.famobi.getMoreGamesButtonImage()}catch(t){a="images/More_Games600x253_onWhite.png"}assetLib=new Utils.AssetLoader(curLang,[{id:"background0",file:"images/background0.jpg"},{id:"background1",file:"images/background1.jpg"},{id:"background2",file:"images/background2.jpg"},{id:"background3",file:"images/background3.jpg"},{id:"background4",file:"images/background4.jpg"},{id:"rotateDeviceMessage",file:"images/rotateDeviceMessage.jpg"},{id:"splash",file:"images/splashScreen.jpg"},{id:"hud",file:"images/hud_450x700.png"},{id:"muteBut",file:"images/mute_54x50.png"},{id:"uiButs",file:"images/uiButs.png",oAtlasData:{id0:{x:180,y:0,width:129,height:86},id1:{x:0,y:216,width:129,height:86},id10:{x:262,y:322,width:61,height:56},id11:{x:131,y:128,width:129,height:86},id12:{x:0,y:0,width:178,height:126},id13:{x:311,y:0,width:54,height:50},id14:{x:0,y:304,width:129,height:86},id15:{x:0,y:128,width:129,height:86},id2:{x:262,y:88,width:129,height:86},id3:{x:262,y:176,width:129,height:86},id4:{x:131,y:304,width:129,height:86},id5:{x:131,y:216,width:129,height:86},id6:{x:325,y:264,width:24,height:24},id7:{x:311,y:52,width:44,height:24},id8:{x:180,y:88,width:60,height:28},id9:{x:262,y:264,width:61,height:56}}},{id:"gameElements",file:"images/gameElements.png",oAtlasData:{id0:{x:0,y:0,width:1010,height:12},id1:{x:0,y:801,width:137,height:147},id10:{x:263,y:844,width:33,height:26},id11:{x:298,y:788,width:31,height:26},id12:{x:228,y:788,width:34,height:26},id13:{x:264,y:788,width:32,height:26},id14:{x:228,y:816,width:34,height:26},id15:{x:281,y:872,width:32,height:26},id16:{x:251,y:957,width:33,height:26},id17:{x:286,y:956,width:31,height:26},id18:{x:215,y:957,width:34,height:26},id19:{x:281,y:928,width:32,height:26},id2:{x:0,y:56,width:1010,height:12},id20:{x:228,y:844,width:33,height:26},id21:{x:286,y:984,width:31,height:26},id22:{x:98,y:950,width:34,height:26},id23:{x:264,y:816,width:32,height:26},id24:{x:98,y:978,width:34,height:26},id25:{x:281,y:900,width:32,height:26},id26:{x:0,y:978,width:46,height:26},id27:{x:0,y:950,width:52,height:26},id28:{x:0,y:291,width:388,height:495},id29:{x:0,y:160,width:450,height:129},id3:{x:0,y:14,width:1010,height:12},id30:{x:0,y:788,width:179,height:11},id31:{x:0,y:1006,width:1,height:1},id32:{x:0,y:1006,width:1,height:1},id33:{x:0,y:1006,width:1,height:1},id34:{x:0,y:1006,width:1,height:1},id35:{x:0,y:1006,width:1,height:1},id36:{x:0,y:1006,width:1,height:1},id37:{x:0,y:1006,width:1,height:1},id38:{x:390,y:291,width:386,height:302},id39:{x:54,y:950,width:42,height:43},id4:{x:0,y:42,width:1010,height:12},id40:{x:139,y:801,width:87,height:87},id41:{x:139,y:890,width:74,height:110},id42:{x:0,y:84,width:453,height:74},id5:{x:0,y:28,width:1010,height:12},id6:{x:215,y:890,width:64,height:65},id7:{x:0,y:70,width:1010,height:12},id8:{x:298,y:816,width:29,height:26},id9:{x:298,y:844,width:26,height:26}}},{id:"numbers0",file:"images/numbers0_28x48.png"},{id:"bubbles",file:"images/bubbles_48x52.png"},{id:"flare",file:"images/flare.png"},{id:"firework0",file:"images/firework0_175x175.png",oAnims:{explode:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]}},{id:"flame",file:"images/flame_247x176.png",oAnims:{burn:[0,1,2,3,4,5,6,7]}},{id:"firework1",file:"images/firework1_175x175.png",oAnims:{explode:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]}},{id:"pop",file:"images/pop_166x167.png",oAnims:{hide:[30],explode0:[0,1,2,3,4,5,6,7],explode1:[8,9,10,11,12,13,14,15],explode2:[16,17,18,19,20,21,22,23],explode3:[24,25,26,27,28,29,30,31],explode4:[32,33,34,35,36,37,38,39],explode5:[40,41,42,43,44,45,46,47,48]}},{id:"langText",file:"json/text.json"},{id:"font0",file:"images/font0.png"},{id:"fontData0",file:"json/font0.json"},{id:"levelData",file:"json/levelData.json"},{id:"title",file:"images/preloadImage.png"},{id:"map",file:"images/map.jpg"},{id:"moreGamesBut",file:a}],ctx,canvas.width,canvas.height),oImageIds.playBut="id0",oImageIds.retryBut="id1",oImageIds.nextBut="id2",oImageIds.muteBut1="id3",oImageIds.muteBut0="id4",oImageIds.menuBut="id5",oImageIds.mapStars0="id6",oImageIds.mapStars1="id7",oImageIds.mapStars2="id8",oImageIds.mapBut0="id9",oImageIds.mapBut1="id10",oImageIds.backBut="id11",oImageIds.bigPlayBut="id12",oImageIds.pauseBut="id13",oImageIds.infoBut="id14",oImageIds.resetBut="id15",oImageIds.aimLine0="id0",oImageIds.star="id1",oImageIds.aimLine1="id2",oImageIds.aimLine2="id3",oImageIds.aimLine3="id4",oImageIds.aimLine4="id5",oImageIds.glint="id6",oImageIds.aimLine5="id7",oImageIds.score10="id8",oImageIds.score15="id9",oImageIds.score20="id10",oImageIds.score25="id11",oImageIds.score30="id12",oImageIds.score35="id13",oImageIds.score40="id14",oImageIds.score45="id15",oImageIds.score50="id16",oImageIds.score55="id17",oImageIds.score60="id18",oImageIds.score65="id19",oImageIds.score70="id20",oImageIds.score75="id21",oImageIds.score80="id22",oImageIds.score85="id23",oImageIds.score90="id24",oImageIds.score95="id25",oImageIds.score100="id26",oImageIds.score500="id27",oImageIds.infoPanel="id28",oImageIds.messagePanel="id29",oImageIds.starBar="id30",oImageIds.launcher0="id31",oImageIds.launcher1="id32",oImageIds.launcher2="id33",oImageIds.launcher3="id34",oImageIds.launcher4="id35",oImageIds.launcher15="id36",oImageIds.launcher5="id37",oImageIds.launcher6="id37",oImageIds.launcher7="id37",oImageIds.introPanel="id38",oImageIds.allColourBubble="id39",oImageIds.starFade="id40",oImageIds.hintFinger="id41",oImageIds.ceiling="id42",assetLib.onReady(initSplash)}function resizeCanvas(){var t=window.innerWidth,a=window.innerHeight,e=canvas.width,i=canvas.height;480<t&&(--t,--a),a<t&&isMobile&&"loading"!=gameState?rotatePauseOn():rotatePause&&isMobile&&rotatePauseOff(),canvasScaleX=canvasScaleY=t/a<canvas.width/canvas.height?(canvas.style.width=t+"px",canvas.style.height=t*i/e+"px",canvasX=0,canvasY=(a-t*i/e)/2,e/t):(canvas.style.width=a/i*e+"px",canvas.style.height=a+"px",canvasX=(t-a/i*e)/2,canvasY=0,i/a),canvas.style.marginTop=canvasY+"px",canvas.style.marginLeft=canvasX+"px",userInput.setCanvas(canvasX,canvasY,canvasScaleX,canvasScaleY)}function playSound(t){1==audioType&&sound.play(t)}function toggleMute(t){muted=!muted,1==audioType?muted?(Howler.mute(),musicTween&&musicTween.kill(),music.pause(),t||(window.famobi_analytics.trackEvent("EVENT_VOLUMECHANGE",{bgmVolume:0,sfxVolume:0}),window.famobi.localStorage.setItem("muted","1"))):(Howler.unmute(),musicTween&&musicTween.kill(),music.play(),"game"==gameState?music.volume(.4):music.volume(.2),t||(window.famobi_analytics.trackEvent("EVENT_VOLUMECHANGE",{bgmVolume:1,sfxVolume:1}),window.famobi.localStorage.removeItem("muted"))):2==audioType&&(muted?music.pause():music.play()),"start"==gameState&&renderMuteBut()}function renderMuteBut(){var t,a,e;0!=audioType&&(t=assetLib.getData("muteBut"),e=0,a=(e=muted?1:e)*t.oData.spriteWidth%t.img.width,e=Math.floor(e/(t.img.width/t.oData.spriteWidth))*t.oData.spriteHeight,ctx.drawImage(t.img,a,e,t.oData.spriteWidth,t.oData.spriteHeight,385,0,t.oData.spriteWidth,t.oData.spriteHeight))}function toggleManualPause(t){t?(manualPause?logEvent({event:"GAME_RESUME"}):logEvent({event:"GAME_PAUSE"}),window.famobi_analytics.trackEvent(manualPause?"EVENT_RESUME":"EVENT_PAUSE").then(_toggleManualPause)):_toggleManualPause()}function _toggleManualPause(){var t,a,e,i;manualPause?(manualPause=!1,userInput.removeHitArea("retryFromPause"),userInput.removeHitArea("resumeFromPause"),userInput.removeHitArea("muteFromPause"),userInput.removeHitArea("menuFromPause"),pauseCoreOff()):(manualPause=!0,pauseCoreOn(),i={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2-70,255],id:oImageIds.retryBut},t={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2+70,255],id:oImageIds.playBut},a=muted?{oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2-70,355],id:oImageIds.muteBut1}:{oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2-70,355],id:oImageIds.muteBut0},e={oImgData:assetLib.getData("uiButs"),aPos:[canvas.width/2+70,355],id:oImageIds.menuBut},userInput.addHitArea("retryFromPause",butEventHandler,{multiTouch:!0},"image",i),userInput.addHitArea("resumeFromPause",butEventHandler,{multiTouch:!0},"image",t),userInput.addHitArea("muteFromPause",butEventHandler,null,"image",a),userInput.addHitArea("menuFromPause",butEventHandler,{multiTouch:!0},"image",e),i=new Array(i,t,a,e),(panel=new Elements.Panel("pause",i)).render(ctx))}function rotatePauseOn(){rotatePause=!0,ctx.drawImage(assetLib.getImg("rotateDeviceMessage"),0,0),userInput.pauseIsOn=!0,pauseCoreOn()}function rotatePauseOff(){rotatePause=!1,userInput.removeHitArea("retryFromPause"),userInput.removeHitArea("resumeFromPause"),userInput.removeHitArea("muteFromPause"),userInput.removeHitArea("menuFromPause"),pauseCoreOff()}function pauseCoreOn(){switch(1==audioType?Howler.mute():2==audioType&&music.pause(),gameState){case"start":case"help":break;case"game":userInput.removeHitArea("pause"),userInput.removeHitArea("startPanelTouch"),userInput.removeHitArea("gameTouch"),userInput.removeHitArea("switchBubble"),userInput.removeHitArea("firstGameTouch")}}function pauseCoreOff(){switch(1==audioType?muted||Howler.unmute():2!=audioType||muted||music.play(),previousTime=(new Date).getTime(),userInput.pauseIsOn=!1,gameState){case"splash":updateSplashScreenEvent();break;case"start":initStartScreen();break;case"map":initMapScreen();break;case"credits":initCreditsScreen();break;case"game":"endFailPanel"!=panel.panelType&&"endPanel"!=panel.panelType&&(panel.posY=550,panel.panelType="game",panel.aButs=new Array),(manualPause?(manualPause=!1,updateGameEvent(),toggleManualPause):(gameControlState&&(userInput.addHitArea("pause",butEventHandler,null,"rect",{aRect:[372,0,445,52]},!0),userInput.addHitArea("switchBubble",butEventHandler,{multiTouch:!0},"rect",{aRect:[48,545,119,663]},!0),userInput.addHitArea("gameTouch",butEventHandler,{isDraggable:!0,multiTouch:!0},"rect",{aRect:[0,0,canvas.width,canvas.height]},!0)),updateGameEvent))()}}curLang=(curLang="en").toUpperCase(),(preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.png"}],ctx,canvas.width,canvas.height,!1)).onReady(initLoadAssets);
