!function(E){var i={stats:{},events:[],currentScreen:"",pageTitle:"",trackStats:function(S,o,T){return new Promise(function(E,e){var t={},n={};"string"==typeof S&&(n[S]=o);if(!function(){for(var E in n)if(!("string"==typeof S&&S.length&&S.length<=42&&S.match(/^[a-z\_0-9]+$/)))return console.warn("trackStats(): key '"+S+"' contains not only lowercase letters, numbers and underscore ([a-z_0-9]), maximum length: 42 characters"),!1;return!0}())return e("trackStats(): invalid params "+JSON.stringify(S,o)),!1;function r(E,e){if("string"==typeof E&&E.length)return E in i.stats&&null==e?delete i.stats[E]:void 0!==e&&e&&(i.stats[E]=e);throw"trackStats(): key is not a string or an Object"}if(S&&"object"==typeof S){for(var a in S)r(a,o=S[a]);t=S}else r(S,o),t[S]=o;famobi.hasOwnProperty("adapters")&&famobi.adapters.run("analytics","trackStats",S,o,T),E(t)})},getStats:function(){return new Promise(function(E,e){E(i.stats)})},trackEvent:function(a,S){return new Promise(function(E,e){if(void 0===i[a])return e("trackEvent(): unknown event '"+a+"'"),!1;if("object"!=typeof(S=S||{})&&null!==S)return e("trackEvent(): second parameter needs to be an object"),!1;if(!function(){var E={levelName:"",reason:["timeout","dead","wrong_answer","quit","draw"],levelScore:-0,liveScore:-0,totalScore:-0,bgmVolume:0,sfxVolume:0},e={EVENT_LEVELFAIL:["levelName","reason"],EVENT_LEVELRESTART:["levelName"],EVENT_LEVELSTART:["levelName"],EVENT_LEVELSUCCESS:["levelName"],EVENT_LEVELSCORE:["levelName","levelScore"],EVENT_LIVESCORE:["liveScore"],EVENT_TOTALSCORE:["totalScore"],EVENT_VOLUMECHANGE:["bgmVolume","sfxVolume"],EVENT_CUSTOM:[]};if(void 0!==e[a]&&0===Object.keys(S).length)return console.warn("trackEvent(): '"+a+"' requires at least one parameter"),!1;if(void 0!==e[a])for(var t,n=0,r=null;n<e[a].length;n++){if("string"==typeof(r=E[t=e[a][n]])&&"string"!=typeof S[t])return console.warn("trackEvent(): required param '"+t+"' has to be of type string"),!1;if("number"==typeof r&&"number"!=typeof S[t])return console.warn("trackEvent(): required param '"+t+"' has to be of type number"),!1;if("object"==typeof r&&-1===r.indexOf(S[t]))return console.warn("trackEvent(): required param '"+t+"' has to be one of \""+r.join('", "')+'"'),!1}return!0}())return e("trackEvent(): invalid params "+JSON.stringify(S));if(i.events.push({event:a,params:S}),famobi.hasOwnProperty("adapters")&&famobi.adapters.run("analytics","trackEvent",a,S),-1<i.TRIGGER_SCORE.indexOf(a)){if(!window.famobi.hasFeature("highscores"))return E(a,S);switch(a){case"EVENT_LEVELSCORE":famobi.submitHighscore(S.levelName,S.levelScore,!0);break;case"EVENT_TOTALSCORE":famobi.submitHighscore("TOTAL",S.totalScore,!0)}return Promise.all([]).then(function(){E(a,S)})}return-1<i.TRIGGER_LEVELSUCCESS.indexOf(a)?Promise.all([window.famobi.showAd()]).then(function(){E(a,S)}):-1<i.TRIGGER_LEVELFAIL.indexOf(a)?"quit"==S.reason?E(a,S):Promise.all([window.famobi.showAd()]).then(function(){E(a,S)}):-1<i.TRIGGER_LEVELSTART.indexOf(a)?Promise.all([]).then(function(){E(a,S)}):(-1<i.TRIGGER_LIVESCORE.indexOf(a)&&famobi.sendLiveScore(S.liveScore),E(a,S))})},getEvents:function(){return new Promise(function(E,e){E(i.events)})},EVENT_CUSTOM:"EVENT_CUSTOM",EVENT_LEVELFAIL:"EVENT_LEVELFAIL",EVENT_LEVELRESTART:"EVENT_LEVELRESTART",EVENT_LEVELSTART:"EVENT_LEVELSTART",EVENT_LEVELSUCCESS:"EVENT_LEVELSUCCESS",EVENT_LIVESCORE:"EVENT_LIVESCORE",EVENT_LEVELSCORE:"EVENT_LEVELSCORE",EVENT_TOTALSCORE:"EVENT_TOTALSCORE",EVENT_TUTORIALCOMPLETED:"EVENT_TUTORIALCOMPLETED",EVENT_TUTORIALSKIPPED:"EVENT_TUTORIALSKIPPED",EVENT_VOLUMECHANGE:"EVENT_VOLUMECHANGE",EVENT_PAUSE:"EVENT_PAUSE",EVENT_RESUME:"EVENT_RESUME",trackScreen:function(t,n){return new Promise(function(E,e){return void 0===i[t]?(e("trackScreen(): unknown screen '"+t+"'"),!1):!n&&-1<t.indexOf(["SCREEN_OTHER"])?(e("trackScreen(): screen '"+t+"' requires param 'pageTitle'"),!1):n&&"string"!=typeof n?(e("trackScreen(): required param 'pageTitle' has to be a non-empty string"),!1):(i.currentScreen=t,i.pageTitle=n,famobi.hasOwnProperty("adapters")&&famobi.adapters.run("analytics","trackScreen",t,n),void E(t,n))})},getScreen:function(){return i.currentScreen},getPageTitle:function(){return i.pageTitle},SCREEN_OTHER:"SCREEN_OTHER",SCREEN_BONUS:"SCREEN_BONUS",SCREEN_CHARACTER:"SCREEN_CHARACTER",SCREEN_CREDITS:"SCREEN_CREDITS",SCREEN_GAMERESULT:"SCREEN_GAMERESULT",SCREEN_HELP:"SCREEN_HELP",SCREEN_HOME:"SCREEN_HOME",SCREEN_LEVEL:"SCREEN_LEVEL",SCREEN_LEVELINTRO:"SCREEN_LEVELINTRO",SCREEN_LEVELLOADING:"SCREEN_LEVELLOADING",SCREEN_LEVELRESULT:"SCREEN_LEVELRESULT",SCREEN_LEVELSELECT:"SCREEN_LEVELSELECT",SCREEN_PAUSE:"SCREEN_PAUSE",SCREEN_SETTINGS:"SCREEN_SETTINGS",SCREEN_SHOP:"SCREEN_SHOP",SCREEN_SPLASH:"SCREEN_SPLASH",SCREEN_TUTORIAL:"SCREEN_TUTORIAL",TRIGGER_SCORE:["EVENT_LEVELSCORE","EVENT_TOTALSCORE"],TRIGGER_LIVESCORE:["EVENT_LIVESCORE"],TRIGGER_LEVELFAIL:["EVENT_LEVELFAIL"],TRIGGER_LEVELSUCCESS:["EVENT_LEVELSUCCESS"],TRIGGER_LEVELSTART:["EVENT_LEVELSTART","EVENT_LEVELRESTART"]};E.famobi_analytics=i}(window);
